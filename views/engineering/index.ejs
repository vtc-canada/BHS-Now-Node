

<div class="row-fluid" style="margin-top:20px;">
    <div class="span10 offset1 page-controls-wrapper">
        <div class="row-fluid" id="reportheader"><span style="padding-left:10px;"><%= __('Engineering') %></span>
                <!--<div style="margin-right:10px;font-weight: 400;" class="btn btn-primary pull-right save_pull" id="save_default_destinations"><%= __('Save') %></div>-->
        </div>
        <div class="row-fluid" id="iframediv" >
            <div class="row-fluid">
                <div class="row-fluid sort-destination-plan-titles airline-config-titles">

                        <div class="btn btn-primary" id="resetregisters">Counts Reset</div>

                              <br/><br/><br/>
                          <div id="hoadiv">
                          </div>
                          

                              <br/><br/><br/>

                    
                </div>
                <div class="row-fluid" id="defaultdestinations">

                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var translate = {
        'en':{
            'Saved':'Airline Configurations have been successfully saved.',
            'You must be admin or manager or operator':'You must have a Security Level of Admin, Manager or Operator to make changes to the Airline Configurations.'
        },
        'es':{
             'Saved':'Airline Configurations have been successfully saved.',
            'You must be admin or manager or operator':'You must be admin or manager or operator.'
        }

    }

</script>

<!-- Default Destination Row Template -->
<script type="text/template" id="hoa-template">
    <div class="row-fluid section-config-wrapper hoa-wrapper" eqp_id="{{=eqp_ID}}" style="color:black">
    {{=eqp_name}}
        <div class="btn-group hoa-group">
		  <button class="hoa-hand btn btn-primary" {{ if(hmioverride_value==1){ }}style="background:black;"{{ } }}">HAND</button>
		  <button class="hoa-off btn btn-primary" {{ if(oos_value==1){ }}style="background:black"{{ } }}">OFF</button>
		  <button class="hoa-auto btn btn-primary" {{ if(oos_value==0&&hmioverride_value==0){ }}style="background:black"{{ } }}">AUTO</button>
		</div>
    </div>
</script>



<script>

    //var defaultdestinations;          // Collection for airline configuration rows
    //var ref_sort_destinations = new Array();      // sort_destinations, lookup, populated on page startup
    $(document).ready(function(){

        $('#resetregisters').click(function(){
              socket.get("/engineering/resetregisters",{},function(val){
				///alert(val);
              });
        });
        
        socket.get("/engineering/joinHOA",{},function(result){
        });
        
        
        //////////////////////
        // HOA   Model      //
        //////////////////////
        // Collection to get the hoas

        var HOAModel = Backbone.Model.extend({
            urlRoot: ''    //not used really
        });

        var SailsHOACollection = Backbone.Collection.extend({
            sailsCollection: "",
            socket: null,
            sync: function(method, model, options){
                var where = options;
                if(typeof this.sailsCollection === "string" && this.sailsCollection !== "") {
                    this.socket = socket;
                    this.socket.get("/" + this.sailsCollection, where, _.bind(function(temphoas){
                        this.set(temphoas);
                        hoaView.render();
                    }, this));

                    this.socket.on("hoa", _.bind(function(temphoas){
                        this.set(temphoas);
                        hoaView.render();
                    }, this));
                }
            }
        });

        var HOACollection = SailsHOACollection.extend({
            sailsCollection: 'engineering/getHOA',
            model: HOAModel
        });

        hoas = new HOACollection();

        hoas.fetch();    // Gets the alarms

        var HOAView = Backbone.View.extend({
            el: '#hoadiv',
	        events: {
	            "click button.hoa-hand"   : "hand",
	            "click button.hoa-off"   : "off",
	            "click button.hoa-auto" : "auto"
	        },
	        hand:function(event){
	        	var thehoa = hoas.findWhere({'eqp_ID':parseInt($(event.target).closest(".hoa-wrapper").attr("eqp_ID"))});
	        	var params = { opc_url : thehoa.get('handreq_opc_url')
	        				, opc_path : thehoa.get('handreq_opc_path')
	        				,tag_address : thehoa.get('handreq_tag_address')};
	        	socket.get('/engineering/sendhoaclick',params,function(response){
	        	
	        	});
	        },
	        off:function(event){
	        	var thehoa = hoas.findWhere({'eqp_ID':parseInt($(event.target).closest(".hoa-wrapper").attr("eqp_ID"))});
	        	var params = { opc_url : thehoa.get('offreq_opc_url')
	        				, opc_path : thehoa.get('offreq_opc_path')
	        				,tag_address : thehoa.get('offreq_tag_address')};
	        	socket.get('/engineering/sendhoaclick',params,function(response){
	        	
	        	});
	        },
	        auto:function(event){
	        	var thehoa = hoas.findWhere({'eqp_ID':parseInt($(event.target).closest(".hoa-wrapper").attr("eqp_ID"))});
	        	var params = { opc_url : thehoa.get('autoreq_opc_url')
	        				, opc_path : thehoa.get('autoreq_opc_path')
	        				,tag_address : thehoa.get('autoreq_tag_address')};
	        	socket.get('/engineering/sendhoaclick',params,function(response){
	        	
	        	});
	        },
            initialize: function () {
            },
            template: _.template($('#hoa-template').html()),
            render: function () {
                this.$el.html("");
                var tcollection = this.collection.sortBy(function(hoarow){
                    return hoarow.get("eqp_ID");
                });
                for(var i=0; i<tcollection.length; i++)
                {
                    this.$el.append(this.template(tcollection[i].toJSON()));
                }
            }
        });

        var hoaView = new HOAView({collection: hoas});
        
    });

</script>
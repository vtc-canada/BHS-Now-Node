<script type="text/template" id="conveyor_straight">
	<div class="hmi-element" tagname="{{=tagname}}" style="position:absolute; background:red;  width:{{=length*elementScale}}%; height:{{=beltWidth*elementScale}}%;">
		<div class="conveyor_straight_wall1"></div>
		<div class="conveyor_straight_wall2"></div>
	</div>
</script>
<script type="text/template" id="conveyor_turn">
	<div class="hmi-element conveyor-turn" tagname="{{=tagname}}" style="position:absolute; background:red; height:{{=beltWidth*elementScale*2}}%;">
		<div class="conveyor_turn_wall1"></div>
		<div class="conveyor_turn_wall2"></div>
	</div>
</script>



<style type="text/css">
      
</style>
    

<div class="row-fluid" style="margin-top:19px;">
    <div class="span10 offset1 page-controls-wrapper">
        <div class="row-fluid" id="reportheader"><span style="padding-left:10px;">BHS Overview</span></div>
        <div class="row-fluid" id="iframediv">
            <div class="row-fluid">
                <div id="overview" class="row-fluid" style="position:relative;">
                    
                </div>
            </div>
        </div>
    </div>
</div>
   
    
    
    <script type="text/javascript">
    
    var aspectRatio = 16/9;
    var elementScale = 4; //(belth width as percent of screen width)
    var beltWidth = 2; // Depends on elementScale
    $(function(){
    
    
    
    	//alert('ready');
    	var overview = $('#overview');
    
    	var conveyor_straight = _.template($('#conveyor_straight').html());	
    	var conveyor_turn = _.template($('#conveyor_turn').html());	
    	
    	/*
    	overview.append(conveyor_straight({top:20,left:0,length:12,rotation:0}));
    	
    	overview.append(conveyor_straight({top:40,left:0,length:12,rotation:30}));
    	overview.append(conveyor_straight({top:60,left:0,length:12,rotation:45}));
    	overview.append(conveyor_straight({top:80,left:0,length:12,rotation:60}));
    	
    	
    	overview.append(conveyor_straight({top:20,left:25,length:12,rotation:90}));
    	overview.append(conveyor_straight({top:40,left:25,length:12,rotation:120}));
    	overview.append(conveyor_straight({top:60,left:25,length:12,rotation:135}));
    	overview.append(conveyor_straight({top:80,left:25,length:12,rotation:150}));
    	
    	overview.append(conveyor_straight({top:20,left:50,length:12,rotation:180}));
    	overview.append(conveyor_straight({top:40,left:50,length:12,rotation:210}));
    	overview.append(conveyor_straight({top:60,left:50,length:12,rotation:225}));
    	overview.append(conveyor_straight({top:80,left:50,length:12,rotation:240}));
    	
    	overview.append(conveyor_straight({top:20,left:75,length:12,rotation:270}));
    	overview.append(conveyor_straight({top:40,left:75,length:12,rotation:300}));
    	overview.append(conveyor_straight({top:60,left:75,length:12,rotation:315}));
    	overview.append(conveyor_straight({top:80,left:75,length:12,rotation:330}));
    	
    	$('.hmi-element').each(function(){
    		$(this).css('transform','rotate(241deg) top');
    	});*/
    	
    	overview.append(conveyor_straight({tagname:'tagname',length:6}));
    	$('.hmi-element:last-child').css('transform','rotate(0deg)').css('top','3%').css('left','3%');
    	
    	overview.append(conveyor_turn({tagname:'tagname'}));
    	$('.hmi-element:last-child').css('transform','rotate(0deg)').css('top','73%').css('left','73%').width($('.hmi-element:last-child').height());
    	
    	
    	
    	overview.append(conveyor_straight({tagname:'tagname',length:4}));
    	$('.hmi-element:last-child').css('transform','rotate(90deg)').css('top','33%').css('left','23%');
    	
    	
    	
    	
    	socket.get('/overview/joinroom');
    	socket.on('overview',function(message){
    		$('div[tagname]').unbind();
    		
    		$.each(message,function(key,message){
    			setBackground($('div[tagname='+message.tag_name+']'),'#'+message.color_code);
    			if(message.is_flashing==1){
	    			setTimeout(function(){
	    				setBackground($('div[tagname='+message.tag_name+']'),'#'+message.flash_color_code);
	    			},500);
    			}
    			
    			/*if(message.value=='on'){
    				setBackground($('#'+message.id),'#ff4400');
    			}else if(message.value=='off'){
    				setBackground($('#'+message.id),'#22ee11');
    			
    			}*/
    		});
    	});
    	
    	
    	
    	function setBackground($element,color){
    		$element.css('background-color',color);
    	
    	}
    	
    	$(window).resize(function(){
    		$('#overview').height($('#overview').width()/aspectRatio);
    	});
    	$(window).resize();
    });
    
    
    </script>
    
<!DOCTYPE html>
<html>
	<head>
		
		<title><%= translate[req.session.user.locale]['DefaultTitle'] %> - <%= translate[req.session.user.locale]['pages'][req.url] %> </title>
	    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	    <meta name="description" content="">
	    <meta name="author" content="">
	    
	   	<link href="/css/ui-lightness/jquery-ui-1.10.3.custom.min.css" rel="stylesheet">
    	<link href="/css/jquery.dataTables.css" rel="stylesheet">
	    <link href="/css/jquery.ui.chatbox.css" rel="stylesheet">
	    <link href="/css/bootstrap.css" rel="stylesheet">
	    <link href="/css/bootstrap-responsive.css" rel="stylesheet">
		<link href="/css/minidash.css" rel="stylesheet">
		<link href="/css/main.css" rel="stylesheet">
	    <link href="/css/chatboxlayout.css" rel="stylesheet">
	    <link href="/css/font-awesome.css" rel="stylesheet">
	    <link href="/css/flighttable.css" rel="stylesheet">
	    <link href="/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
	    <link href="/css/bootstrap-combobox.css" rel="stylesheet">
	
	
	
	    <link href="/css/messages.css" rel="stylesheet">
	    <link href="/css/create-reports.css" rel="stylesheet">
	    <link href="/css/dropdownpages.css" rel="stylesheet">
	    <link href="/css/dashboard.css" rel="stylesheet">


		<!--[if lt IE 9]>
		<link href="/css/oldie.css" rel="stylesheet">
		<![endif]-->
		<!--[if lt IE 10]>
		<link href="/css/ie9andbelow.css" rel="stylesheet">
		<![endif]-->

		<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		<script src="/js/html5shiv.js"></script>
		<![endif]-->


		<!-- Pre-Minimized assets are loaded here -->
		<script type="text/javascript" src="/js/dependencies/sails.io.js"></script>
		<script type="text/javascript" src="/js/jquery.js"></script>
		<script type="text/javascript" src="/js/bootstrap-combobox.js"></script>
		<script type="text/javascript" src="/js/bootstrap.js"></script>
		<script type="text/javascript" src="/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script type="text/javascript" src="/js/jquery.ui.chatbox.js"></script>
		<script type="text/javascript" src="/js/jquery.ui.chatboxManager.js"></script>
		
		
		<!-- Fav and touch icons -->
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/favicon.ico">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/favicon.ico">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/favicon.ico">
		<link rel="apple-touch-icon-precomposed" href="/img/favicon.png">
		<link rel="shortcut icon" href="/img/favicon.ico">
		<link rel="icon" href="/img/favicon.ico" type="image/x-icon">
		<link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon">
		
		
  </head>

  <body>
  
      <!-- This Modal Dialog is displayed when the user goes to change his password from the myaccount dropdown -->
      <div id="changepasswordModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
              <h3 id="myModalLabelChange"><%= translate[req.session.user.locale]['Change Password']  %></h3>
          </div>
          <div class="modal-body">
              <div class="row-fluid"><p><%= translate[req.session.user.locale]['Enter a new password for']  %> <b><%=req.session.user.username%></b>.</p></div>
              <div class="row-fluid"><label class="change-label" for="mycurrentpassword"><%= translate[req.session.user.locale]['Current Password']  %>:</label><input class="change-input" id="mycurrentpassword" type="password"></div>
              <div class="row-fluid"><label class="change-label" for="mynewpassword"><%= translate[req.session.user.locale]['New Password']  %>:</label><input class="change-input" id="mynewpassword" type="password"></div>
              <div class="row-fluid"><label class="change-label" for="confirmmypassword"><%= translate[req.session.user.locale]['Confirm Password']  %>:</label><input class="change-input"  id="confirmmypassword" type="password"> </div>
          </div>
          <div class="modal-footer">
              <button class="btn" data-dismiss="modal" id="confirmmypasswordchangecancel" aria-hidden="true"><%= translate[req.session.user.locale]['Cancel']  %></button>
              <button class="btn btn-primary" id="confirmmypasswordchange"><%= translate[req.session.user.locale]['Set']  %></button>
          </div>
      </div>
      
      
     <!-- This is the top bar containing both the mobile and desktop responsive layouts-->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse-topbar">
            <span class="icon icon-gear"></span>
          </button>
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse-primary">
              <span class="icon-list"></span>
          </button>
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target="#chat-section-wrapper">
              <span class="icon-envelope"></span>
          </button>
            <a class="brand isys-a large" href="/auth" style="height:40px; width: 407px; padding-left: 12px !important;"><img src="<%=logo.desktop%>" /></a>
            </a>
            <a class="brand isys-a small" href="/auth" style="height: 40px; width: 110px;background-image: url(&quot;<%=logo.mobile%>&quot;);background-size: 140px;background-repeat: no-repeat;background-position-x: 11px;">
            </a>
          <div class="nav-collapse collapse nav-collapse-topbar">
            <ul class="nav pull-right" id="top_right_desktop">
              <li id="liLocation">
                  <% if(req.session.user.locale=='en'){ %>
                    <a class="top-message-a language-a" style="position:relative;"><div class="language-flag english"></div><div class="top-flag-span top-messages-span">English</div></a>
                  <% } %>
                  <% if(req.session.user.locale=='es'){ %>
                    <a class="top-message-a language-a" style="position:relative;"><div class="language-flag chile"></div><div class="top-flag-span top-messages-span">Español</div></a>
                  <% } %>
              </li>

              <li <% if (typeof(url)!='undefined'&&url=='communication'){ %>class="active"<% } %>><a class="top-message-a" href="/communication" style="position:relative;"><div style="display:none;" class="badge-div" ><span class="badge badge-important">6</span></div><i class="icon-envelope-alt icon-2x top-messages-icon"></i><div class="top-messages-span"><%= translate[req.session.user.locale]['Messages'] %></div></a></li>
              <li><form id="search-form" action="/search" method="post" style="margin-bottom: 0px;" ><input name="search_field" type="text" placeholder="<%= translate[req.session.user.locale]['Search'] %>" id="main-search" class="main-search"><i class="icon-search top-search-icon"></i></form></li>
              <li class="myaccount-topmenu"><a id="myaccount" data-placement="bottom" data-content="Loading.." title="" data-original-title="" ><i class="icon-user"></i>&nbsp<%= req.session.user.username %></a>
                  <!--[if lt IE 9]>
                  <![endif]-->
                  <ul id="myaccountmobile" class="collapse">
                      <li class="<% if (typeof(url)!=='undefined'&&url=='myaccount'){ %>active<% } %>">
                          <a id="changemypasswordmobile">
                              <i class="icon-gear"></i> <%= translate[req.session.user.locale]['Change Password'] %>
                          </a>
                      </li>
                      <li class="">
                          <a href="/logout">
                              <i class="icon-signout"></i> <%= translate[req.session.user.locale]['Sign Out']  %>
                          </a>
                      </li>
                  </ul>
              </li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="sidebar-background">
  		<div class="primary-sidebar-background"></div>
	</div>

      <!-- SideBar  -  the elements are styled and attached to the top bar buttons when in mobile layout -->
	<div class="primary-sidebar">
	  <div class="primary-sidebar-spacer"></div>
	  <!-- Main nav -->
	  <ul class="nav nav-collapse collapse nav-collapse-primary">
  			<% for(var navpage in navpages){  %>
  				<% if(!navpages[navpage].enabled){ %>
  					<% continue; %>
  				<% } %>
  				<li class="<% if(typeof(navpages[navpage].children)!='undefined'){ %>dark-nav<% } %> <% if((req.url==navpage)||templateHelper.hasChildPage(navpages[navpage],req.url)){ %>active<% } %>">
  				  <span class="glow"></span>   
	              <a <% if(typeof(navpages[navpage].children)!='undefined'){ %>class="accordion-toggle" data-toggle="collapse" href="#navmenu<%=templateHelper.replaceAll(navpage,'/','_')%>"<% }else{ %> href="<%=navpage%>" <% } %>>
	                  <i class="<%=navpages[navpage].icon%> icon-2x"></i>
	                  <span><%= translate[req.session.user.locale]['pages'][navpage] %>
	                  <% if(typeof(navpages[navpage].children)!='undefined'){ %>
                      <i class="icon-caret-down"></i>
	                  <% } %>
	                  </span>
	              </a>
	              <% if(typeof(navpages[navpage].children)!='undefined'){ %>
                    <ul id="navmenu<%=templateHelper.replaceAll(navpage,'/','_')%>" class="collapse <% if(templateHelper.hasChildPage(navpages[navpage],req.url)){ %>in<% } %>">
                		<% for(var childpage in navpages[navpage].children){  %>
			  				<% if(!navpages[navpage].children[childpage].enabled){ %>
			  					<% continue; %>
			  				<% } %>
			  				
			  				<li class="<% if(req.url==childpage){ %>active<% } %>">
				              <a href="<%=childpage%>">
				                  <i class="<%=navpages[navpage].children[childpage].icon%>"></i>
				                  <%= translate[req.session.user.locale]['pages'][childpage] %>
				              </a>
			  				</li>
			  				
		  				<% } %>
          			</ul>
                  <% } %>
  				</li>
  			<% } %>
      </ul>

        <div id="chat-section-wrapper" class="showchatusers collapse nav-collapse">
            <div class="row-fluid" id="users-toggler"><i class="icon-envelope-alt"></i> &nbsp&nbsp<%= translate[req.session.user.locale]['Messaging'] %></div>
            <div id="user-search-box" class="user-search-box"><input type="text" id="users-search" placeholder="<%= translate[req.session.user.locale]['Search people'] %>..."></div>
            <ul id="chatwrapper" class="chatnav  nav-collapse-chat">

            </ul>
        </div>
	  </div>
    </div>
 
 
     <!-- Scripts are loaded here at the latest possible place to allow the layout html to be rendered ASAP -->
    <script src="/js/underscore-min.js"></script>
    <script src="/js/backbone-min.js"></script>
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/autoNumeric.js"></script>
    <script type="text/javascript" src="/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="/js/jquery.sparkline.min.js"></script>
    <script type="text/javascript" src="/js/raphael.2.1.0.min.js"></script>
    <script type="text/javascript" src="/js/justgage.1.0.1.min.js"></script>
    <script type="text/javascript" src="/js/fastclick.js"></script>
  
  
<!-- MAIN LAYOUT Script-->
<!-- This Section contains the messaging scripts, socket calls, and many other utility functions for all the pages -->
	<script>
		var socket = io.connect();
		var bannertimer = null;
		_.templateSettings = {
		    interpolate : /\{\{\=(.+?)\}\}/g,
		    evaluate: /\{\{(.+?)\}\}/g
		};
		
		$(window).resize(function(){
	        fixheight();
	    });
	    function fixheight(){
	        $('.main-content').css('height',$(window).height()-$('.navbar').height()+'px');
	    }
	    $(document).ready(function(){
	    	fixheight();
	    });
	    function clearBanners(){
	    	$('.main-content > .page-banner').next('.alert').remove();
	    }
	    function bannerAlert(type,bold,message){
	    	$('.main-content > .page-banner').next('.alert').remove();
	    	clearTimeout(bannertimer);
			var banner = '<div class="alert alert-'+type+' fade in" style="border-radius:0px;">'
				    +'<button type="button" class="close" data-dismiss="alert">&times</button>'
				    +'<strong>'+bold+':&nbsp</strong>'
				    +message
				+'</div>';
	    	$('.main-content > .page-banner').after(banner);
	    	if($(window).width()>=980){
	    		$('.main-content').animate({
	    			scrollTop:0
    			},300);
	    	}else{
	    		$('body').animate({
	    			scrollTop:0
    			},300);
	    	}
	    	bannertimer = setTimeout(function(){
	            bannertimer = setTimeout(function(){
	                $('.main-content > .page-banner').next('.alert').remove();
	            },500);
	            $('.main-content > .page-banner').next('.alert').removeClass('in');
	    	},5000);
	    }
	
		$('#myaccount').popover({
			container:'#top_right_desktop'
			,placement:'bottom'
			,html:true
			,trigger:'manual'
			,content:'<a class="pull-right close myaccount-close-x popover-close" sort_plan_id="myaccount">&times;</a><div class="row-fluid myaccount-popover-username" style="width:100px;"><%= req.session.user.username %></div><div class="row-fluid" style="width:120px;"><a onclick="showChangeMyPasswordModal();" class="span12 btn"><%= translate[req.session.user.locale]['Change Password'] %></a></div><div class="row-fluid" style="width:120px;"><a href="/auth/logout" class="span12 btn btn-danger"><%= translate[req.session.user.locale]['Sign Out'] %></a></div>'
		});
		
		// TODO: Find a way to refactor these popover conflicts.
		$('#myaccount').click(function(e) {
	        e.preventDefault();
	        if($(window).width()<980){
	        	$('#myaccountmobile').collapse('toggle');
	        }else{
		        $('#myaccount').popover('toggle');
		        setTimeout(function(){
		            $('.popover[sort_plan_id=myaccount]').css('left',($('#top_right_desktop').width()-$('.popover[sort_plan_id=myaccount]').width())+'px');
		        },0);
		        $('#top_right_desktop').find('.popover').attr('sort_plan_id','myaccount');
		        $('.ganntbar[sort_plan_id!=myaccount]').popover('hide');
		        $('#add_flight').popover('hide');
		
		        $('.myaccount-close-x').click(function(){
		            $('#myaccount').popover('hide');
		        });
	        }
	    });
	    
	    function showChangeMyPasswordModal(){
	        $('#changepasswordModal').modal('show');
	        $('#changepasswordModal div.alert-error').remove();
	        $('#mycurrentpassword').val('');
	        $('#mynewpassword').val('');
	        $('#confirmmypassword').val('');
	        $('#confirmmypasswordchange').removeAttr('disabled');
	        $('#confirmmypasswordchangecancel').removeAttr('disabled');
	    }
	  
	</script>
  
  
  
  
  
  
  
  
      <!-- The MAIN DIV -- BODY SECTION -->
      <!-- This is where the actual pages themselves get loaded in -->
    <div class="main-content">
       <!-- <div class="main-content-padder"></div>-->
   		<%- body %>
    </div> <!-- /container -->


  </body>
</html>

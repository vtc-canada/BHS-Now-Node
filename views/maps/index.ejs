<%
    var translate = {
        'en' : {
            'You do not have sufficient privileges to access':'You do not have sufficient privileges to access',
            'Error':'Error',
            'Buildings':'Buildings',
            'Date':'Date',
            'Equipment':'Equipment',
            'Device':'Device',
            'Alarm Type':'Alarm Type',
            'System Health':'System Health',
            'System Throughput':'System Throughput',
            'Time In System':'Time In System',
            'BHS Overview':'BHS Overview',
            'Time':'Time',
            'Alarms':'Alarms',
            'Daily Reminders':'Daily Reminders',
            'Predictive Mainenance Tasks':'Predictive Mainenance Tasks',
            'DEVICE':'DEVICE',
            'REASON':'REASON',
            'Uptime':'Uptime',
            'Failsafe Rate':'Failsafe Rate',
            'Tracking Rate':'Tracking Rate',
            'Key Performance Indicators':'Key Performance Indicators',
            'Throughput (bph)':'Throughput (bph)',
            'State':'State',
            'Jam Rate':'Jam Rate',
            'ATR Read Rate':'ATR Read Rate',
            'Cancel':'Cancel',
            'Delete':'Delete',
            'To create a new owner':'To create a new owner, select the contact and/or company associated with this building',
            'To create a new sale':'To create a new sale, click create',
            'Create':'Create',
            'Contact':'Contact',
            'Company':'Company'
        },
        'es' : {
            'You do not have sufficient privileges to access':'Usted no tiene suficientes privilegios para acceder a',
            'Error':'Error',
            'Buildings':'Salpicadero',
            'Date':'Date',
            'Equipment':'Equipment',
            'Device':'Device',
            'REASON':'REASON',
            'Alarm Type':'Alarm Type',
            'System Health':'System Health',
            'System Throughput':'System Throughput',
            'Time In System':'Time In System',
            'BHS Overview':'BHS Overview',
            'Time':'Time',
            'Alarms':'Alarms',
            'Daily Reminders':'Daily Reminders',
            'Predictive Mainenance Tasks':'Predictive Mainenance Tasks',
            'DEVICE':'DEVICE',
            'Uptime':'Uptime',
            'Failsafe Rate':'Failsafe Rate',
            'Tracking Rate':'Tracking Rate',
            'Key Performance Indicators':'Key Performance Indicators',
            'Throughput (bph)':'Throughput (bph)',
            'State':'State',
            'Jam Rate':'Jam Rate',
            'ATR Read Rate':'ATR Read Rate',
            'Cancel':'Cancel',
            'Delete':'Delete',
            'To create a new owner':'To create a new owner, select the contact and/or company associated with this building',
            'To create a new sale':'To create a new sale, click create',
            'Create':'Create',
            'Contact':'Contact',
            'Company':'Company'
        }
    }
%>

<!--<div class="row-fluid page-banner">
    <div class="banner-div"><i class="icon-building icon-1x banner-icon-top"></i><div class="banner-div-text"><%= translate[req.session.user.locale]['Buildings'] %></div></div>
</div>
-->
        <!-- Throws in Error messages if they were passed in from the controller -->
<% if(typeof(errormessage)!='undefined'){ %>
<div class="alert alert-error" style="border-radius:0px;">
    <button type="button" class="close" data-dismiss="alert">Ã—</button>
    <strong><%= translate[req.session.user.locale]['Error'] %>:</strong>
    <%= translate[req.session.user.locale][errormessage] %><% if(typeof(errorurl)!='undefined'){ %> <%= errorurl %><% } %>
</div>
<% } %>

<div id="map_wrapper" style="width:100%;">

</div>

<div id="building_slideup_wrapper" style="width:100%;">

</div>



<div id="search_controls" class="row-fluid">
	
	<div class="row-fluid" id="search_toggler" style="position:relative" scrollstate="top">
		<div class="arrow-down search-toggler-arrow"><i class="icon-chevron-down icon-3x"></i></div>
		<div class="arrow-down scroll-icon"><i class="icon-search icon-3x"></i></div>
		<div class="arrow-up search-toggler-arrow"><i class="icon-chevron-up icon-3x"></i></div>
		<div class="arrow-up scroll-icon"><i class="icon-globe icon-3x"></i></div>
		
	</div>
	<div class="row-fluid create-report-controls-wrapper">
		<div class="span10 offset1 report-control-left-label" style="min-height: 30px;padding-top: 5px; font-size:18px; font-weight:bold;margin-top: 33px;">
			<i class="icon-search icon-2x banner-icon-top" style="margin-top: -12px; margin-right: 10px;"></i><div class="banner-div-text">Search Filters</div>
		
		</div>
	</div>
    <div class="row-fluid create-report-controls-wrapper">
        <div class="span10 offset2 create-report-controls" style="padding-top: 10px;">
           <div class="row">
           
               <div class="row">
                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_address">Address:</label></div>
                   <div class="span8 report-control-right-control">
                       <input type="text" id="search_address" value="">
                   </div>
               </div>
               <div class="row">
                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_owner">Owner Contact:</label></div>
                   <div class="span8 report-control-right-control">
                       <input type="text" id="search_owner" value="">
                   </div>
               </div>
               <div class="row">
                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_owner_company">Owner Company:</label></div>
                   <div class="span8 report-control-right-control">
                       <input type="text" id="search_owner_company" value="">
                   </div>
               </div>
               <div class="row" style="min-height: 40px;">
                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_property_mgmt_company">Property Management Company:</label></div>
                   <div class="span8 report-control-right-control">
                       <input type="text" id="search_property_mgmt_company" value="">
                   </div>
               </div>
               
               <div class="row" style="min-height: 40px;">
                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="reporttype">Units:</label></div>
                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
                   		<div class="row-fluid">
                   			<div class="pull-left slider-min-val-label" ><span id="units_min">0</span></div>
                   			
                   			<input id="units_slider" type="text" class="" value="" data-slider-min="0" data-slider-max="1000" data-slider-step="5" data-slider-value="[0,1000]"/>
                   			&nbsp&nbsp
                   			<span id="units_max">1000+</span>
                   		</div>
                   </div>
               </div>
               <div class="row" style="min-height: 40px;">
                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="reporttype">Unit Price:</label></div>
                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
                   		<div class="row-fluid">
                   			<div class="pull-left slider-min-val-label" ><span id="unit_price_min">0</span></div>
                   			
                   			<input id="unit_price_slider" type="text" class="" value="" data-slider-min="0" data-slider-max="250" data-slider-step="5" data-slider-value="[0,250]"/>
                   			&nbsp&nbsp
                   			<span id="unit_price_max">250+</span>
                   		</div>
                   </div>
               </div>
               <div class="row">
               		<div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;">
               			<label for="start_time">Sale Date:</label>
           			</div>
           			<div class="input-append span3 report-control-right-control" id="start_time_gen">
           				<input class="" data-format="yyyy-MM-dd" style="width:150px; max-width:70%;" id="start_time" type="text" value="">
       					<span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar" class="icon-calendar"> </i> </span>
       				</div>
           			<div class="input-append span1 report-control-right-control">
       					<span style="display: inline-block;width: auto;height: 20px;min-width: 16px;padding: 4px 5px;font-size: 14px;font-weight: normal;line-height: 20px;">to</span>
					</div>
           			<div class="input-append span3 report-control-right-control" id="end_time_gen">
           				<input class="" data-format="yyyy-MM-dd" style="width:150px; max-width:70%;" id="end_time" type="text" value="">
   						<span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar" class="icon-calendar"> </i> </span>
       				</div>
       				
   				</div>
           </div>
        </div>
    </div>
    <div class="row-fluid create-report-controls-wrapper">
        <div class="span10 offset1 create-report-controls" style="padding-top: 10px;">
	   		<a id="advanced_criteria_toggler" data-toggle="collapse" data-target="#collapseadvanced" style="text-decoration: none; color: #5a6573;">
				<div style="float:left;"></i><i class="icon-plus-sign icon-2x"></i></div><div style="float: left; padding-bottom: 5px;margin-top: -6px;margin-left: 20px;"><h4>Advanced Criteria</h4></div>
			</a>
		</div>
  	</div>
  	
    <div class="row-fluid create-report-controls-wrapper">
        <div class="span10 offset2 create-report-controls" style="padding-top: 10px;">
           <div class="row">
           		<div class="row collapse" id="collapseadvanced">
               		
	               <div class="row-fluid">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_seller">Seller Contact:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_seller" value="">
	                   </div>
	               </div>
	               <div class="row-fluid">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_seller_company">Seller Company:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_seller_company" value="">
	                   </div>
	               </div>
	               <div class="row-fluid">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_agent">Agent Contact:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_agent" value="">
	                   </div>
	               </div>
	               <div class="row-fluid">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_agent_company">Agent Company:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_agent_company" value="">
	                   </div>
	               </div>
               		
               		<div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label>Building Type:</label></div>
	        			<div class="span8 report-control-right-control" style="margin-bottom:10px;">
							<% for(var i=0;i<building_types.length;i++){ %>
							<div class="row-fluid" style="margin-top: 5px;"><input type="checkbox" class="segment-form-radio building-type-checkboxes" name="building-type-radio" building_type="<%-building_types[i].id%>" id="building_type_<%-building_types[i].id%>">&nbsp;&nbsp;&nbsp;<label for="building_type_<%-building_types[i].id%>" style="display: inline;"><%-building_types[i].type%></label></div>
							<% } %>
						</div>   
	               </div>
               		
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_prev_property_mgmt_company">Previous Property Management Company:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_prev_property_mgmt_company" value="">
	                   </div>
	               </div>
               
               	   <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label>Heat System:</label></div>
	        			<div class="span8 report-control-right-control" style="margin-bottom:10px;">
							<% for(var i=0;i<heat_types.length;i++){ %>
							<div class="row-fluid" style="margin-top: 5px;"><input type="checkbox" class="segment-form-radio heating-type-checkboxes" name="heat-type-radio" heat_type="<%-heat_types[i].id%>" id="heat_type_<%-heat_types[i].id%>">&nbsp;&nbsp;&nbsp;<label for="heat_type_<%-heat_types[i].id%>" style="display: inline;"><%-heat_types[i].type%></label></div>
							<% } %>
						</div>   
	               </div>
               
               
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="heat_age_slider">Heat System Installed Year:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="heat_age_min">0</span></div>
	                   			
	                   			<input id="heat_age_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="heat_age_max">+</span>
	                   		</div>
	                   </div>
	               </div>
               		<div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="boiler_installed_year_slider">Boiler Installed Year:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="boiler_installed_year_min">0</span></div>
	                   			
	                   			<input id="boiler_installed_year_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="boiler_installed_year_max">+</span>
	                   		</div>
	                   </div>
	               </div>
               		<div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="boiler_upgrade_slider">Last Boiler Upgrade Year:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="boiler_upgrade_min">0</span></div>
	                   			
	                   			<input id="boiler_upgrade_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="boiler_upgrade_max">+</span>
	                   		</div>
	                   </div>
	               </div>
               		<div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_isp">Cable Internet Provider:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_isp" value="">
	                   </div>
	               </div>
               
	               	<div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_elevator">Elevator:</label></div>
	                   <div class="span8 report-control-right-control" >
	                       <select id="search_elevator">
							<option value="null">Any</option>
							<option value="true">Yes</option>
							<option value="false">No</option>
						  </select>
	                   </div>
	               </div>
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="elevator_installed_year_slider">Elevator Installed Year:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="elevator_installed_year_min">0</span></div>
	                   			
	                   			<input id="elevator_installed_year_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="5" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="elevator_installed_year_max">250+</span>
	                   		</div>
	                   </div>
	               </div>
	               
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="elevator_upgrade_year_slider">Last Elevator Upgrade Year:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="elevator_upgrade_year_min">0</span></div>
	                   			
	                   			<input id="elevator_upgrade_year_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="5" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="elevator_upgrade_year_max">250+</span>
	                   		</div>
	                   </div>
	               </div>
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="windows_installed_year_slider">Windows Installed Year:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="windows_installed_year_min">0</span></div>
	                   			
	                   			<input id="windows_installed_year_slider" type="text"  value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="windows_installed_year_max">+</span>
	                   		</div>
	                   </div>
	               </div> 
	              <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="parking_spots_slider">Number of Parking Spots:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="parking_spots_min">0</span></div>
	                   			
	                   			<input id="parking_spots_slider" type="text"  value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="parking_spots_max">+</span>
	                   		</div>
	                   </div>
	               </div>  
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="assessed_value_slider">Assessed Value:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="assessed_value_min">0</span></div>
	                   			
	                   			<input id="assessed_value_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="assessed_value_max">+</span>
	                   		</div>
	                   </div>
	               </div>
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;"><label for="search_mortgage">Mortgage Company:</label></div>
	                   <div class="span8 report-control-right-control">
	                       <input type="text" id="search_mortgage" value="">
	                   </div>
	               </div>
	               
	               <div class="row-fluid">
	               		<div class="span3 report-control-left-label"  style="min-height: 30px;padding-top: 5px;">
	               			<label for="start_mortgage_due_date">Mortgage Due Date:</label>
	           			</div>
	           			<div class="input-append span3 report-control-right-control" id="start_mortgage_due_date_gen">
	           				<input class="" data-format="yyyy-MM-dd" style="width:150px; max-width:70%;" id="start_mortgage_due_date" type="text" value="">
	       					<span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar" class="icon-calendar"> </i> </span>
	       				</div>
	           			<div class="input-append span1 report-control-right-control">
	       					<span style="display: inline-block;width: auto;height: 20px;min-width: 16px;padding: 4px 5px;font-size: 14px;font-weight: normal;line-height: 20px;">to</span>
						</div>
	           			<div class="input-append span3 report-control-right-control" id="end_mortgage_due_date_gen">
	           				<input class="" data-format="yyyy-MM-dd" style="width:150px; max-width:70%;" id="end_mortgage_due_date" type="text" value="">
	   						<span class="add-on"><i data-time-icon="icon-time" data-date-icon="icon-calendar" class="icon-calendar"> </i> </span>
	       				</div>
	   				</div>
	   				
	               
	               
	               
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bachelor_rent_slider">Bachelor Rent Price:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bachelor_rent_min">0</span></div>
	                   			
	                   			<input id="bachelor_rent_slider" type="text" class="rent-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bachelor_rent_max">+</span>
	                   		</div>
	                   </div>
	               </div>

	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bedroom1_rent_slider">1 Bedroom Rent Price:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bedroom1_rent_min">0</span></div>
	                   			
	                   			<input id="bedroom1_rent_slider" type="text" class="rent-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bedroom1_rent_max">+</span>
	                   		</div>
	                   </div>
	               </div>
	               
   	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bedroom2_rent_slider">2 Bedroom Rent Price:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bedroom2_rent_min">0</span></div>
	                   			
	                   			<input id="bedroom2_rent_slider" type="text" class="rent-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bedroom2_rent_max">+</span>
	                   		</div>
	                   </div>
	               </div>	
	               
   	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bedroom3_rent_slider">3 Bedroom Rent Price:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bedroom3_rent_min">0</span></div>
	                   			
	                   			<input id="bedroom3_rent_slider" type="text" class="rent-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bedroom3_rent_max">+</span>
	                   		</div>
	                   </div>
	               </div>               
	               
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bachelor_units_slider">Bachelor Units:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bachelor_units_min">0</span></div>
	                   			
	                   			<input id="bachelor_units_slider" type="text" class="units-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bachelor_units_max">+</span>
	                   		</div>
	                   </div>
	               </div>

	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bedroom1_units_slider">1 Bedroom Units:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bedroom1_units_min">0</span></div>
	                   			
	                   			<input id="bedroom1_units_slider" type="text" class="units-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bedroom1_units_max">+</span>
	                   		</div>
	                   </div>
	               </div>
	               
   	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bedroom2_units_slider">2 Bedroom Units:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bedroom2_units_min">0</span></div>
	                   			
	                   			<input id="bedroom2_units_slider" type="text" class="units-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bedroom2_units_max">+</span>
	                   		</div>
	                   </div>
	               </div>	
	               
   	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="bedroom3_units_slider">3 Bedroom Units:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="bedroom3_units_min">0</span></div>
	                   			
	                   			<input id="bedroom3_units_slider" type="text" class="units-slider" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="bedroom3_units_max">+</span>
	                   		</div>
	                   </div>
	               </div> 
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="building_income_slider">Building Income:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="building_income_min">0</span></div>
	                   			
	                   			<input id="building_income_slider" type="text" value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="building_income_max">+</span>
	                   		</div>
	                   </div>
	               </div> 
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="cap_rate_slider">CAP Rate:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="cap_rate_min">0</span></div>
	                   			
	                   			<input id="cap_rate_slider" type="text" class="" value="" data-slider-min="" data-slider-max="" data-slider-step="5" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="cap_rate_max">250+</span>
	                   		</div>
	                   </div>
	               </div>
	               
	               
	               
   	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="sale_price_slider">Last Sale Price:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="sale_price_min">0</span></div>
	                   			
	                   			<input id="sale_price_slider" type="text"  value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="sale_price_max">+</span>
	                   		</div>
	                   </div>
	               </div> 
	               
	               <div class="row-fluid" style="min-height: 40px;">
	                   <div class="span3 report-control-left-label" style="min-height: 30px;padding-top: 5px;"><label for="sales_count_slider">Number of Sale History Records:</label></div>
	                   <div class="span7 report-control-right-control" style="min-height: 30px;padding-top: 5px;">
	                   		<div class="row-fluid">
	                   			<div class="pull-left slider-min-val-label"><span id="sales_count_min">0</span></div>
	                   			
	                   			<input id="sales_count_slider" type="text"  value="" data-slider-min="" data-slider-max="" data-slider-step="" data-slider-value=""/>
	                   			&nbsp&nbsp
	                   			<span id="sales_count_max">+</span>
	                   		</div>
	                   </div>
	               </div> 
	   			</div>
           </div>
       </div>
   </div>
           
</div>


<!-- There next templates are the pieces of the BHS Overview drawing -->
<!-- In order, they represent the columns across the diagram -->


<div id="table_controls" class="row-fluid" style="margin-top:0px;">
    <div class="span10 offset1 page-controls-wrapper">
        <div class="row-fluid" id="reportheader"><span style="padding-left:10px;">Buildings</span>
             <!--<div style="margin-right:10px;font-weight: 400;" class="btn btn-primary pull-right save_pull" id="create_building">Create New</div>-->
        
        </div>
        <div class="row-fluid " id="iframediv" style="padding: 0px;">
            <div class="row-fluid">
                <table id="buildings" class="display" cellspacing="0" width="100%">
			        <thead>
			            <tr>
			            	<th>Id<i class="icon-caret-down"></i><i class="icon-caret-up"></i></th>
			                <th>Address<i class="icon-caret-down"></i><i class="icon-caret-up"></i></th>
			                <th>Units<i class="icon-caret-down"></i><i class="icon-caret-up"></i></th>
			                <th>Owner<i class="icon-caret-down"></i><i class="icon-caret-up"></i></th>
			                <th>Property Manager<i class="icon-caret-down"></i><i class="icon-caret-up"></i></th>
			                <th>Sale Date<i class="icon-caret-down"></i><i class="icon-caret-up"></i></th>
			            </tr>
			        </thead>
			 
			    </table>
            </div>
        </div>
    </div>
</div>



<script type="text/template" id="building-template">
	<div class="row-fluid building-map-details" style="position:relative; cursor:default;" building_id="{{=building_id}}">
		<div style="position: absolute;top: 0px;right: 0px;color: #C52D22;cursor: pointer;margin-right: 12px;margin-top: 7px;">
		<i class="icon-remove-sign icon-2x close-building-map-details"></i>
		</div>
		<div class="building-details-padder">	
			<div class="row-fluid" style="white-space:nowrap;">
				{{ var tempimages = JSON.parse(images); if(tempimages!=null&&tempimages.length>0){ }}
				<div class="building-card-images-wrapper">
					{{var images = JSON.parse(images); for( key in images){ }}
				 		<a href="{{=images[key].image}}" data-lightbox="{{=images[key].image}}" class="span2 building-overlay-block-picture"><img src="{{=images[key].thumb}}"></a>
					{{ } }}
				</div>
				{{ } }}
				<div class="span3 building-overlay-block-address">
					<div class="row-fluid">Address:</div>
					<div class="row-fluid block-value">{{=address_1}}</div>
					<div class="row-fluid block-value">{{=address_2}}</div>
					<div class="row-fluid block-value"><a href="/buildings/{{=building_id}}">View History</a></div>
				</div>
				
				<div class="span3 building-overlay-block-details">
					{{ for(var i=0; i<contacts.length; i++){ if(contacts[i].contact_type=='owner'){ }}
					<div class="row-fluid" contact_id="{{=contacts[i].contact_id}}">
						<div class="pull-left">Owner:</div>
						<div class="pull-right">{{=contacts[i].contact_name}}</div>
					</div>
					{{ } } }}
					{{ for(var i=0; i<contacts.length; i++){ if(contacts[i].contact_type=='seller'){ }}
					<div class="row-fluid" contact_id="{{=contacts[i].contact_id}}">
						<div class="pull-left">Seller:</div>
						<div class="pull-right">{{=contacts[i].contact_name}}</div>
					</div>
					{{ } } }}
					<div class="row-fluid">
						<div class="pull-left">Prop. Mngr:</div>
						<div class="pull-right">{{=property_mgmt_company}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">Price:</div>
						<div class="pull-right block-value">{{=last_sale_price}}</div>
					</div>
				</div>
				<div class="span3 building-overlay-block-details">
					<div class="row-fluid">
						<div class="pull-left">Amount of Suites:</div>
						<div class="pull-right block-value">{{=unit_quantity}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">Sale Date:</div>
						<div class="pull-right block-value">{{=sale_date}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">Price Per Unit:</div>
						<div class="pull-right block-value">{{=unit_price}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">Price:</div>
						<div class="pull-right block-value">{{=last_sale_price}}</div>
					</div>
					
				</div>
				<div class="span3 building-overlay-block-details">
					<div class="row-fluid">
						<div class="pull-left">Bachelor Rent:</div>
						<div class="pull-right block-value">{{=bachelor_price}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">1 Bdrm Rent:</div>
						<div class="pull-right block-value">{{=bedroom1_price}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">2 Bdrm Rent:</div>
						<div class="pull-right block-value">{{=bedroom2_price}}</div>
					</div>
					<div class="row-fluid">
						<div class="pull-left">3 Bdrm Rent:</div>
						<div class="pull-right block-value">{{=bedroom3_price}}</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</script>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAbxXYHzi3ypnRymTns27yE_o-fEyj6cIE"></script>



<script>

   	var unitsMax = null;
	var unitsMin = null;
	var building_income_max = null;
	var elevator_installed_year_max = null;
	var unit_price_max = null;
	var elevator_upgrade_year_max = null;
	var cap_rate_max = null;
	var sale_price_max = null;
	var assessed_value_max = null;
	var boiler_installed_year_max = null;
	var boiler_upgrade_max = null;
	var heat_age_max = null;
	var sales_count_max = null;
	var windows_installed_year_max = null;
	var parking_spots_max = null;
	
	var building_income_min = null;
	var elevator_installed_year_min = null;
	var unit_price_min = null;
	var elevator_upgrade_year_min = null;
	var cap_rate_min = null;
	var sale_price_min = null;
	var assessed_value_min = null;
	var boiler_installed_year_min = null;
	var boiler_upgrade_min = null;
	var heat_age_min = null;
	var sales_count_min = null;
	var windows_installed_year_min = null;
	var parking_spots_min = null;
	    	
	var bachelor_units_min = null;
	var bachelor_units_max = null;
	var bedroom1_units_min = null;
	var bedroom1_units_max = null;
	var bedroom2_units_min = null;
	var bedroom2_units_max = null;
	var bedroom3_units_min = null;
	var bedroom3_units_max = null;
	
	var bachelor_rent_min = null;
	var bachelor_rent_max = null;
	var bedroom1_rent_min = null;
	var bedroom1_rent_max = null;
	var bedroom2_rent_min = null;
	var bedroom2_rent_max = null;
	var bedroom3_rent_min = null;
	var bedroom3_rent_max = null;
	
	var sliderLimit = 1000;
	var MAX_CAP_RATE = 100;
	var MIN_CAP_RATE = 0;
	var STEP_CAP_RATE = 1;
	var MIN_HEAT_AGE = 1900;
	var MAX_HEAT_AGE = 2100;
	var STEP_HEAT_AGE = 10;
	var MIN_BOILER_INSTALLED_YEAR = 1900;
	var MAX_BOILER_INSTALLED_YEAR = 2100;
	var STEP_BOILER_INSTALLED_YEAR = 10;
	var MIN_BOILER_UPGRADE = 1900;
	var MAX_BOILER_UPGRADE = 2100;
	var STEP_BOILER_UPGRADE = 10;
	
	var MIN_ASSESSED_VALUE = 0;
	var MAX_ASSESSED_VALUE = 100000000;
	var STEP_ASSESSED_VALUE = 10000;
	
	var MIN_ROOM_RENT = 0;
	var MAX_ROOM_RENT = 10000;
	var STEP_ROOM_RENT = 10;
	var MIN_ROOM_UNITS = 0;
	var MAX_ROOM_UNITS = 1000;
	var STEP_ROOM_UNITS = 1;
	
	var MIN_BUILDING_INCOME = 0;
	var MAX_BUILDING_INCOME = 10000000;
	var STEP_BUILDING_INCOME = 1000;
	
	var MIN_UNIT_PRICE = 5000;
	var MAX_UNIT_PRICE = 300000;
	var STEP_UNIT_PRICE = 10;

	var MIN_SALE_PRICE = 0;
	var MAX_SALE_PRICE = 100000000;
	var STEP_SALE_PRICE = 1000;
	
	var MIN_SALES_COUNT = 0;
	var MAX_SALES_COUNT = 10;
	var STEP_SALES_COUNT = 1;
	
	var MIN_WINDOWS_INSTALLED_YEAR = 1900;
	var MAX_WINDOWS_INSTALLED_YEAR = 2100;
	var STEP_WINDOWS_INSTALLED_YEAR = 10;
	var MIN_PARKING_SPOTS = 0;
	var MAX_PARKING_SPOTS = 2000;
	var STEP_PARKING_SPOTS = 10;
	
	var MIN_ELEVATOR_UPGRADE_YEAR = 1900;
	var MAX_ELEVATOR_UPGRADE_YEAR = 2100;
	var STEP_ELEVATOR_UPGRADE_YEAR = 10;
	
	var MIN_ELEVATOR_INSTALLED_YEAR = 1900;
	var MAX_ELEVATOR_INSTALLED_YEAR = 2100;
	var STEP_ELEVATOR_INSTALLED_YEAR = 10;

	var markers,map;
    var alarms;
    var minimumTableSize = 420;
    var layers = {}
        
    
    $(document).ready(function(){
    
    	var unitsMax = null;
    	var unitsMin = null;
    	var sliderLimit = 1000;
        var leaveSalesExpanded = false;
    
    	var buildingtemplate = _.template($('#building-template').html());
    	
    	
    	function buildingSelected(building_id){
    		//$('#building_slideup_wrapper').empty();
			setMapSize();
    		socket.get('/buildings/getbuilding/'+building_id,{},function(responseBuilding){
    			socket.get('/buildings/getcontacts/'+building_id,{},function(responseContacts){
    				if(typeof(responseContacts[0])!='undefined'){
    					responseBuilding.contacts = responseContacts[0];
    				}else{
    					responseBuilding.contacts = [];
    				}
    				$('#building_slideup_wrapper').empty();
    				responseBuilding.address_1=buildStreetString(responseBuilding.street_number_begin,responseBuilding.street_number_end,responseBuilding.street_name);
	    			responseBuilding.address_2=buildCityProvincePostalCodeString(responseBuilding.city,responseBuilding.province,responseBuilding.postal_code);
	    			responseBuilding.sale_date=toDateTimeString(responseBuilding.sale_date);
	    			
    				responseBuilding.unit_price = responseBuilding.unit_price==null?'$0.00':'$'+responseBuilding.unit_price.toFixed(2);
    				responseBuilding.last_sale_price = responseBuilding.last_sale_price==null?'$0.00':'$'+responseBuilding.last_sale_price;
    				responseBuilding.bachelor_price = responseBuilding.bachelor_price==null?'$0.00':'$'+responseBuilding.bachelor_price;
    				responseBuilding.bedroom1_price = responseBuilding.bedroom1_price==null?'$0.00':'$'+responseBuilding.bedroom1_price;
    				responseBuilding.bedroom2_price = responseBuilding.bedroom2_price==null?'$0.00':'$'+responseBuilding.bedroom2_price;
    				responseBuilding.bedroom3_price = responseBuilding.bedroom3_price==null?'$0.00':'$'+responseBuilding.bedroom3_price;
    				
    				
	    			$('#building_slideup_wrapper').append(buildingtemplate(responseBuilding));
	    			$('.close-building-map-details').click(function(){
	    				$(this).parents('.building-map-details').remove();
	    				setMapSize();
	    			});
	    			setTimeout(function(){
						setMapSize();
	    			},500);
					setMapSize();
					
					markers.blockIdleEvent = true;
					map.panTo(markers.getPosition(building_id));
    			});
    			
    		});
    	
    		// if it's being filled for the first time:
    		//if($('#building_slideup_wrapper').html()!=''){
    		//	$('#map_wrapper').height($('#map_wrapper').height()-$('#building_slideup_wrapper').height()); //shrink the map height
    		//}
    	}
    	
    	$('#search_toggler').click(function(){
    		snapFar();
    	});
    
    
    	function Markers(){
    		var self = this;
    		
    		this.constrainGPS = false;
    		this.blockIdleEvent = true;
    		this.collection = {};
    		
    		this.clearMarkers = function (){
    			for(marker in self.collection){
    				self.collection[marker].destroy();
    			}
    			self.collection = {};
    		}
    		
    		this.addMarker = function(building)
    		{
    			if(building.latitude !=null)
    			{
    				self.collection[building.building_id] = (new ActiveMarker(building,map));
				}
    			//if(!constrainGPS&&!map.getBounds().contains(self.collection[building.building_id].googleMarker.getPosition())){
    				
    			//}
    		}
    		
    		this.checkMarkersBounded = function(){
    			for(marker in self.collection){
    				if(typeof(self.collection[marker].googleMarker)!='undefined'){
	    				if(!map.getBounds().contains(self.collection[marker].googleMarker.getPosition())){
	    					return false;
	    				}
    				}
    			}
    			return true;
    		}
    		
    		this.verifyBounds = function(){
				//  Create a new viewpoint bound
				if(!self.constrainGPS&&!self.checkMarkersBounded()){  // only attempting to check and correct position if we're not in lat/lng mode
    				self.blockIdleEvent = true;
    				var bounds = new google.maps.LatLngBounds ();
	    			for(marker in self.collection){
	    				if(typeof(self.collection[marker].googleMarker)!='undefined'){
	    					bounds.extend(self.collection[marker].googleMarker.getPosition());
	    				}
	    			}
					map.fitBounds(bounds);
				}
    		}
    		
			this.clearSelected = function(){
				for(marker in self.collection){
    				self.collection[marker].clearSelected();
    			}
			}
    		
    		this.toggle = function(building_id){
    			if(typeof(self.collection[building_id])!='undefined'){
    				self.collection[building_id].toggle();
    			}
    		}
    		
    		this.getPosition = function(building_id){
    			return self.collection[building_id].getPosition();
    		}
    		
    	} 
    	
    	function ActiveMarker(building){
    		var self = this;
    		this.building = building;
    		this.googleMarker;
    		this.selected = false;
    		
    		var blueColor = "2F76EE"; // a random blue color that i picked
			this.blueImage = new google.maps.MarkerImage("/img/markers/bluemarker.png",
            new google.maps.Size(21, 34),
            new google.maps.Point(0,0),
            new google.maps.Point(10, 34));
            var redColor = "F75448"
            this.redImage = new google.maps.MarkerImage("/img/markers/redmarker.png",
            new google.maps.Size(21, 34),
            new google.maps.Point(0,0),
            new google.maps.Point(10, 34));
			this.pinShadow = new google.maps.MarkerImage("/img/markers/shadow.png",
            new google.maps.Size(40, 37),
            new google.maps.Point(0, 0),
            new google.maps.Point(12, 35));
            
            this.getPosition = function(){
            	return self.googleMarker.getPosition();
            }
    		
    		if(building.latitude!=null)
			{
    			self.googleMarker = new google.maps.Marker({
				    position: new google.maps.LatLng(building.latitude,building.longitude),
				    map: map,
				    icon:this.redImage,
				    title:(typeof(building.street_number_begin)!='undefined'?building.street_number_begin:'')+(typeof(building.street_number_end)!='undefined'?'-'+building.street_number_end:'')+(typeof(building.street_name)!='undefined'?' '+building.street_name:'')
				});
				google.maps.event.addListener(self.googleMarker,'click',function(){
					self.toggle();
				});
			}
			this.clearSelected = function(){
				self.selected = false;
				$('#buildings > tbody > tr[building_id='+self.building.building_id+']').removeClass('selected');
				self.googleMarker.setIcon(self.redImage);
			}
			this.toggle = function(){
				self.selected = !self.selected;
				if(self.selected){
					markers.clearSelected();
					$('#buildings > tbody > tr[building_id='+self.building.building_id+']').addClass('selected');
					self.googleMarker.setIcon(self.blueImage);
					buildingSelected(self.building.building_id);
				}else{
					$('#buildings > tbody > tr[building_id='+self.building.building_id+']').removeClass('selected');
					self.googleMarker.setIcon(self.redImage);
				}
			}
			this.destroy = function(){
    				google.maps.event.clearListeners(self.googleMarker, 'click');
    				self.googleMarker.setMap(null);
    				self.googleMarker = null;
			}
    	}
    
    
    	function initMap(){
	    	var mapOptions = {
	          center: new google.maps.LatLng(43.7, -79.4),
	          zoom: 10,
	          panControl:false,
	          streetViewControl:true,
	          streetViewControlOptions:{
			        position: google.maps.ControlPosition.TOP_LEFT
			    },
	          mapTypeControl:true,
	          mapTypeControlOptions: {
			        style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
			        position: google.maps.ControlPosition.TOP_LEFT
			    },
	          overviewMapControl:false
	        };
    		
    		//$('#map_wrapper').height($('body').height()-$('.navbar-fixed-top').height()-50);
    		setMapSize();
    		
    		map = new google.maps.Map($('#map_wrapper')[0],mapOptions);
    		
    		layers.go = new google.maps.KmlLayer('https://rems.principledadvisor.ca/img/layers/go.kmz',{preserveViewport: true});
			layers.ttc = new google.maps.KmlLayer('https://rems.principledadvisor.ca/img/layers/ttc.kmz',{preserveViewport: true});
			layers.viva = new google.maps.KmlLayer('https://rems.principledadvisor.ca/img/layers/viva.kmz',{preserveViewport: true});
			
    		  // Create the DIV to hold the control and call the HomeControl() constructor
			  // passing in this DIV.
		  	var homeControlDiv = document.createElement('div');
		  	var homeControl = new HomeControl(homeControlDiv, map);
		
		  	homeControlDiv.index = 1;
		  	map.controls[google.maps.ControlPosition.RIGHT_TOP].push(homeControlDiv);
    		
			//var layerGo = new google.maps.KmlLayer('http://isystemsnow.com/layers/ttc.kmz');
			//layerGo.setMap(map);
    		
    		google.maps.event.addListener(map, 'tilesloaded', function() {
    			google.maps.event.clearListeners(map, 'tilesloaded');
    			initDataTable();
    			
				$('.title-collapse-wrapper').click(function(){
					if($('.map-collapse-content').css('display')=='none'){  //currently empty
		        		$('.title-collapse-wrapper > i.icon-plus-sign').removeClass('icon-plus-sign').addClass('icon-minus-sign');
		        	}else{  // currently shown
		        		$('.title-collapse-wrapper > i.icon-minus-sign').removeClass('icon-minus-sign').addClass('icon-plus-sign');
		        	}
		        	$('.map-collapse-content').slideToggle('medium',function(){
	
		        	});
				});
	        });
	        google.maps.event.addListener(map, 'idle', function() {  
	        	if(typeof(datatable)!='undefined')
	        	{
        			if(!markers.blockIdleEvent){
        				markers.constrainGPS = true;
        				$('#constrain_gps').prop('checked',true);
						datatable.api().ajax.reload();
        			}else{
        				markers.blockIdleEvent = false;
    				}
    			}
	        });
    		markers = new Markers();
    	}
    
    	google.maps.event.addDomListener(window, 'load', initMap);
    
	    $('#buildings').on('draw.dt',function(event,datatable){
	    		//if($('#building_slideup_wrapper').html()!='')
	    		//{
	    		
	    		//}
	    		$('#building_slideup_wrapper').empty();
				setMapSize();
				setMapTableSize();
	    		markers.clearMarkers();
		    	if(datatable.json.data instanceof Array)
		    	{
		    		for(var i=0; i< datatable.json.data.length; i++){
		    			markers.addMarker(datatable.json.data[i]);
		    		}
		    	}
		    	markers.verifyBounds();
    	});
    
    
    	
    
    
    
    
    	
    	
		
		
		
		var datatable 
		function initDataTable(){
			//return;
			//$('.main-content').animate({scrollTop:$(document).height()}, 'fast');
			
			//var calc_datatable_scroll_height = $('body').height()-$('.navbar-fixed-top').height()-$('#search_controls').height()-$('#table_controls').height()+$('#buildings_wrapper div.dataTables_scrollBody').height()-48;

        	//setMapSize();
			//$('#map_wrapper').height()
    		//search_controls
			
			datatable = $('#buildings').dataTable({
					"scrollY":        0+ "px",
			        "processing": true,
			        "serverSide": true,
			        "iDisplayLength": 50,
			        "lengthMenu":[[25,50,100],[25,50,100]], //,250,500,1000,"All"
			        "dom":"ltipr",
			        "ajax": {
			        	"url":"/buildings/getajax",
		        		"data":function(d){
		        			d.address_search = $("#search_address").val();
		        			d.owner_search = $("#search_owner").val();
		        			d.owner_company_search = $("#search_owner_company").val();
		        			d.seller_search = $("#search_seller").val();
		        			d.seller_company_search = $("#search_seller_company").val();
		        			d.agent_search = $("#search_agent").val();
		        			d.agent_company_search = $("#search_agent_company").val();
		        			d.mortgage_search = $('#search_mortgage').val();
		        			
		        			d.unitQuantityMin = unitsMin==0?null:unitsMin;
		        			d.unitQuantityMax = unitsMax==sliderLimit?null:unitsMax;
		        			d.unit_price_min = (parseInt(unit_price_min)==MIN_UNIT_PRICE)?null:unit_price_min;
		        			d.unit_price_max = unit_price_max==MAX_UNIT_PRICE?null:unit_price_max;
		        			
		        			d.saleDateRangeStart = $('#start_time').val()==''?null:typeof($('#start_time_gen').data('datetimepicker'))=='undefined'?null:$('#start_time_gen').data('datetimepicker').getLocalDate().toUTCString();	        			
	        				d.saleDateRangeEnd =$('#end_time').val()==''?null: typeof($('#end_time_gen').data('datetimepicker'))=='undefined'?null:$('#end_time_gen').data('datetimepicker').getLocalDate().toUTCString();
	
		        			d.has_elevator = ($('#search_elevator').val()=='null'||$('#search_elevator').val()==null)?null:($('#search_elevator').val()=='true'||$('#search_elevator').val()==true?true:false);
		        			d.elevator_installed_year_min = elevator_installed_year_min==MIN_ELEVATOR_INSTALLED_YEAR?null:elevator_installed_year_min;
		        			d.elevator_installed_year_max = elevator_installed_year_max==MAX_ELEVATOR_INSTALLED_YEAR?null:elevator_installed_year_max;
		        			d.elevator_upgrade_year_min = elevator_upgrade_year_min==MIN_ELEVATOR_UPGRADE_YEAR?null:elevator_upgrade_year_min;
		        			d.elevator_upgrade_year_max = elevator_upgrade_year_max==MAX_ELEVATOR_UPGRADE_YEAR?null:elevator_upgrade_year_max;
		        			
		        			d.cap_rate_min = cap_rate_min==MIN_CAP_RATE?null:cap_rate_min;
		        			d.cap_rate_max = cap_rate_max==MAX_CAP_RATE?null:cap_rate_max;
		        			d.search_property_mgmt_company = $('#search_property_mgmt_company').val();
		        			d.search_prev_property_mgmt_company = $('#search_prev_property_mgmt_company').val();
		        			d.heat_age_min = heat_age_min==MIN_HEAT_AGE?null:heat_age_min;
		        			d.heat_age_max = heat_age_max==MAX_HEAT_AGE?null:heat_age_max;
		        			
		        			d.boiler_installed_year_min = boiler_installed_year_min==MIN_BOILER_INSTALLED_YEAR?null:boiler_installed_year_min;
		        			d.boiler_installed_year_max = boiler_installed_year_max==MAX_BOILER_INSTALLED_YEAR?null:boiler_installed_year_max;
		        			
		        			d.boiler_upgrade_min = boiler_upgrade_min==MIN_BOILER_UPGRADE?null:boiler_upgrade_min;
		        			d.boiler_upgrade_max = boiler_upgrade_max==MAX_BOILER_UPGRADE?null:boiler_upgrade_max;
		        			
		        			d.assessed_value_min = assessed_value_min==MIN_ASSESSED_VALUE?null:assessed_value_min;
		        			d.assessed_value_max = assessed_value_max==MAX_ASSESSED_VALUE?null:assessed_value_max;
		        			
		        			d.building_income_min = building_income_min==MIN_BUILDING_INCOME?null:building_income_min;
		        			d.building_income_max = building_income_max==MAX_BUILDING_INCOME?null:building_income_max;
		        			
		        			d.sale_price_min = sale_price_min==MIN_SALE_PRICE?null:sale_price_min;
		        			d.sale_price_max = sale_price_max==MAX_SALE_PRICE?null:sale_price_max;
		        			
		        			d.bachelor_units_min = bachelor_units_min==MIN_ROOM_UNITS?null:bachelor_units_min;
		        			d.bachelor_units_max = bachelor_units_max==MAX_ROOM_UNITS?null:bachelor_units_max;
		        			
		        			d.bedroom1_units_min = bedroom1_units_min==MIN_ROOM_UNITS?null:bedroom1_units_min;
		        			d.bedroom1_units_max = bedroom1_units_max==MAX_ROOM_UNITS?null:bedroom1_units_max;
		        			
		        			d.bedroom2_units_min = bedroom2_units_min==MIN_ROOM_UNITS?null:bedroom2_units_min;
		        			d.bedroom2_units_max = bedroom2_units_max==MAX_ROOM_UNITS?null:bedroom2_units_max;
		        			
		        			d.bedroom3_units_min = bedroom3_units_min==MIN_ROOM_UNITS?null:bedroom3_units_min;
		        			d.bedroom3_units_max = bedroom3_units_max==MAX_ROOM_UNITS?null:bedroom3_units_max;
		        			
		        			d.bachelor_rent_min = bachelor_rent_min==MIN_ROOM_RENT?null:bachelor_rent_min;
		        			d.bachelor_rent_max = bachelor_rent_max==MAX_ROOM_RENT?null:bachelor_rent_max;
		        			
		        			d.bedroom1_rent_min = bedroom1_rent_min==MIN_ROOM_RENT?null:bedroom1_rent_min;
		        			d.bedroom1_rent_max = bedroom1_rent_max==MAX_ROOM_RENT?null:bedroom1_rent_max;
		        			
		        			d.bedroom2_rent_min = bedroom2_rent_min==MIN_ROOM_RENT?null:bedroom2_rent_min;
		        			d.bedroom2_rent_max = bedroom2_rent_max==MAX_ROOM_RENT?null:bedroom2_rent_max;
		        			
		        			d.bedroom3_rent_min = bedroom3_rent_min==MIN_ROOM_RENT?null:bedroom3_rent_min;
		        			d.bedroom3_rent_max = bedroom3_rent_max==MAX_ROOM_RENT?null:bedroom3_rent_max;
		        			
		        			d.windows_installed_year_min = windows_installed_year_min==MIN_WINDOWS_INSTALLED_YEAR?null:windows_installed_year_min;
		        			d.windows_installed_year_max = windows_installed_year_max==MAX_WINDOWS_INSTALLED_YEAR?null:windows_installed_year_max;
		        			
		        			d.parking_spots_min = parking_spots_min==MIN_PARKING_SPOTS?null:parking_spots_min;
		        			d.parking_spots_max = parking_spots_max==MAX_PARKING_SPOTS?null:parking_spots_max;
		        			
					
		        			d.cable_internet_provider = $('#search_isp').val();
		        			
		        			
		        			d.start_mortgage_due_date = $('#start_mortgage_due_date').val();
		        			d.end_mortgage_due_date = $('#end_mortgage_due_date').val();
		        			
		        			d.sales_count_min = sales_count_min==MIN_SALES_COUNT?null:sales_count_min;
		        			d.sales_count_max = sales_count_max==MAX_SALES_COUNT?null:sales_count_max;
		        			var checkbox_building_types = '';
		        			$('.building-type-checkboxes').each(function(){
		        				if($(this).is(':checked')){
		        					if(checkbox_building_types != ''){
		        						checkbox_building_types = checkbox_building_types + ',';
		        					}
		        					checkbox_building_types = checkbox_building_types + $(this).attr('building_type');
		        				}
		        			});	        			
		        			if(checkbox_building_types!=''){
		        				checkbox_building_types = checkbox_building_types;
		        			}
		        			d.checkbox_building_types = checkbox_building_types;
		        			
		        			var checkbox_heating_types = '';
		        			$('.heating-type-checkboxes').each(function(){
		        				if($(this).is(':checked')){
		        					if(checkbox_heating_types != ''){
		        						checkbox_heating_types = checkbox_heating_types + ',';
		        					}
		        					checkbox_heating_types = checkbox_heating_types + $(this).attr('heat_type');
		        				}
		        			});        			
		        			if(checkbox_heating_types!=''){
		        				checkbox_heating_types = checkbox_heating_types;
		        			}
		        			d.checkbox_heating_types = checkbox_heating_types;
		        			
	        			
		        			if(markers.constrainGPS)
		        			{
			        			d.boundsLatitudeMin = map.getBounds().getSouthWest().lat();
			        			d.boundsLatitudeMax = map.getBounds().getNorthEast().lat();
			        			d.boundsLongitudeMin = map.getBounds().getSouthWest().lng();
			        			d.boundsLongitudeMax = map.getBounds().getNorthEast().lng();
		        			}else{
			        			d.boundsLatitudeMin = null;
			        			d.boundsLatitudeMax = null;
			        			d.boundsLongitudeMin = null;
			        			d.boundsLongitudeMax = null;
		        			}
		        		},
		        		error: function(xhr, error, thrown){
		        			if(error.toString()=='parsererror'){
		        				location.reload();
		        			}
		        		}
		        		
		        	},
			        "aoColumns":[
			        	{"mData":"building_id","visible":false}
			         	,{"mData":function(data,b){ 
				        	return "<b>"+buildAddressString(data)+"</b>"; }
				        }
				        ,{"mData":"units"}
				        ,{"mData":"owner"}
				        ,{"mData":"property_mgmt_company"}
				        ,{"mData":function(data,b){ 
				        	return ""+toDateTimeString(data.sale_date)+""; }
				        	}
			        ],
			        "rowCallback": function( row, data, displayIndex ) {
						$(row).attr('building_id',data['building_id']);
						$(row).click(function(){
							markers.toggle(parseInt($(row).attr('building_id')));
	    					//building.fetch({id:parseInt($(row).attr('building_id'))});
	               		});
		               
			        }
		    });
		    $('#buildings_length select').attr('id','building_length_select');
		    
		    $('#result_size_wrapper').append($('#building_length_select'));
		    $('#buildings_length').remove();
		    //datatable.api().fnLengthChange($('#result_size').val());
		    
        
	        $('#buildings tbody').on('click', 'tr', function () {
	       // 	$(this).siblings().removeClass('selected');
	       // 	$(this).removeClass('selected').addClass('selected');
		    });
		    
			//$('#constrain_gps').click(function(){
				
			//});
	    }
	    
	    
	    function HomeControl(controlDiv, map) {
		
			  // Set CSS styles for the DIV containing the control
			  // Setting padding to 5 px will offset the control
			  // from the edge of the map.
			  controlDiv.style.padding = '5px';
			
			  // Set CSS for the control border.
			  var controlUI = document.createElement('div');
			  controlUI.id = 'map_control';
			  controlUI.className="map-overlay-controls";
			  controlDiv.appendChild(controlUI);
			  
			  var titlecollapsewrapper = document.createElement('div');
			  titlecollapsewrapper.className = 'title-collapse-wrapper';
			  controlUI.appendChild(titlecollapsewrapper);
			  
			  var collapseicon = document.createElement('i');
			  collapseicon.className = 'icon-plus-sign';
			  titlecollapsewrapper.appendChild(collapseicon);
			  
			  var mapcontrolstitlediv = document.createElement('div');
			  mapcontrolstitlediv.className = 'map-overlay-title-label';
			  mapcontrolstitlediv.innerHTML = 'Map Controls';
			  titlecollapsewrapper.appendChild(mapcontrolstitlediv);
			  
			  
			  
			  var collapsecontent = document.createElement('div');
			  collapsecontent.className = 'map-collapse-content';
			  collapsecontent.style.display='none';
			  controlUI.appendChild(collapsecontent);
			  
			  // Set CSS for the control interior.
			  var constrainLabel = document.createElement('label');
			  constrainLabel.htmlFor  = 'constrain_gps';
			  constrainLabel.className= 'map-overlay-label';
			  constrainLabel.innerHTML = 'Constrain result to map bounds';
			  
			  // Set CSS for the control interior.
			  var constrainGPSCheckbox = document.createElement('input');
			  constrainGPSCheckbox.id = 'constrain_gps'
			  constrainGPSCheckbox.type = 'checkbox';
			  constrainGPSCheckbox.className = 'map-overlay-checkbox';
			  var condiv = document.createElement('div');
			  condiv.className = 'map-control-row-wrapper';
			  condiv.appendChild(constrainGPSCheckbox);
			  condiv.appendChild(constrainLabel);
			  collapsecontent.appendChild(condiv);
			  
			  
			  
			  // Set CSS for the control interior.
			  var layerGo = document.createElement('label');
			  layerGo.htmlFor  = 'layer_go';
			  layerGo.className= 'map-overlay-label';
			  layerGo.innerHTML = 'Go Transit';
			  // Set CSS for the control interior.
			  var inputGo = document.createElement('input');
			  inputGo.id = 'layer_go'
			  inputGo.type = 'checkbox';
			  inputGo.className = 'map-overlay-checkbox';
			  
			  var godiv = document.createElement('div');
			  godiv.className = 'map-control-row-wrapper';
			  godiv.appendChild(inputGo);
			  godiv.appendChild(layerGo);
			  collapsecontent.appendChild(godiv);
			  
			  
			  
			  // Set CSS for the control interior.
			  var layerTTC = document.createElement('label');
			  layerTTC.htmlFor  = 'layer_ttc';
			  layerTTC.className= 'map-overlay-label';
			  layerTTC.innerHTML = 'TTC';
			  
			  // Set CSS for the control interior.
			  var inputTTC = document.createElement('input');
			  inputTTC.id = 'layer_ttc'
			  inputTTC.type = 'checkbox';
			  inputTTC.className = 'map-overlay-checkbox';
			  
			  var ttcdiv = document.createElement('div');
			  ttcdiv.className = 'map-control-row-wrapper';
			  ttcdiv.appendChild(inputTTC);
			  ttcdiv.appendChild(layerTTC);
			  collapsecontent.appendChild(ttcdiv);
			  
			  
			   // Set CSS for the control interior.
			  var layerViva = document.createElement('label');
			  layerViva.htmlFor  = 'layer_viva';
			  layerViva.className= 'map-overlay-label';
			  layerViva.innerHTML = 'VIVA';
			  
			  // Set CSS for the control interior.
			  var inputViva = document.createElement('input');
			  inputViva.id = 'layer_viva'
			  inputViva.type = 'checkbox';
			  inputViva.className = 'map-overlay-checkbox';
			  
			  var vivadiv = document.createElement('div');
			  vivadiv.className = 'map-control-row-wrapper';
			  vivadiv.appendChild(inputViva);
			  vivadiv.appendChild(layerViva);
			  collapsecontent.appendChild(vivadiv);
			  
			  
			  var resultSizeLabel = document.createElement('label');
			  resultSizeLabel.htmlFor  = 'building_length_select';
			  resultSizeLabel.className= 'map-overlay-label map-overlay-results-label';
			  resultSizeLabel.innerHTML = 'Result Size:';
			  
			  var resultsizediv = document.createElement('div');
			  resultsizediv.className = 'map-control-row-wrapper';
			  resultsizediv.id = 'result_size_wrapper';
			  resultsizediv.appendChild(resultSizeLabel);
			  collapsecontent.appendChild(resultsizediv);
			  			
			  
			google.maps.event.addDomListener(inputGo, 'change', function() {
				if(layers.go.getMap()==null){
					layers.go.setMap(map);
				}else{
					layers.go.setMap(null);
				}
			});
			google.maps.event.addDomListener(inputTTC, 'change', function() {
				if(layers.ttc.getMap()==null){
					layers.ttc.setMap(map);
				}else{
					layers.ttc.setMap(null);
				}
			});
			google.maps.event.addDomListener(inputViva, 'change', function() {
				if(layers.viva.getMap()==null){
					layers.viva.setMap(map);
				}else{
					layers.viva.setMap(null);
				}
			});
			google.maps.event.addDomListener(constrainGPSCheckbox, 'click', function() {
				markers.constrainGPS = $('#constrain_gps').is(':checked');
				if(markers.constrainGPS&&!markers.checkMarkersBounded()) //markers aren't bounded correct.
				{
					datatable.api().ajax.reload();
				}else if(!markers.constrainGPS){  // this is the case where maybe you've typed in new search terms.
					datatable.api().ajax.reload();
				}
			});
		}

		$('#search_address').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_owner').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_owner_company').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_seller').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_seller_company').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_agent').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_agent_company').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_mortgage').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		
		$('.building-type-checkboxes').click(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		
		});
		$('.heating-type-checkboxes').click(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		
		});
		$('#search_elevator').change(function(){
			datatable.api().ajax.reload();
		});
		$('#search_property_mgmt_company').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_prev_property_mgmt_company').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('#search_isp').keydown(function(){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		
		function initSliders(){
		
		
		
			$('.rent-slider').attr('data-slider-min',MIN_ROOM_RENT); // corrects limit
			$('.rent-slider').attr('data-slider-max',MAX_ROOM_RENT); // corrects limit
			$('.rent-slider').attr('data-slider-step',STEP_ROOM_RENT); // corrects limit
			$('.rent-slider').attr('data-slider-value','['+MIN_ROOM_RENT+','+MAX_ROOM_RENT+']');
			$('.rent-slider').slider({tooltip: 'disabled'});
			$('.units-slider').attr('data-slider-min',MIN_ROOM_UNITS); // corrects limit
			$('.units-slider').attr('data-slider-max',MAX_ROOM_UNITS); // corrects limit
			$('.units-slider').attr('data-slider-step',STEP_ROOM_UNITS); // corrects limit
			$('.units-slider').attr('data-slider-value','['+MIN_ROOM_UNITS+','+MAX_ROOM_UNITS+']');
			$('.units-slider').slider({tooltip: 'disabled'});
			
			
			$('#bachelor_rent_min').html(MIN_ROOM_RENT);
			$('#bachelor_rent_max').html(MAX_ROOM_RENT+'+');
			$('#bachelor_rent_slider').on('slide',function(slideEvt){
				bachelor_rent_min = slideEvt.value[0];
				bachelor_rent_max = slideEvt.value[1];
				$('#bachelor_rent_min').html(bachelor_rent_min);
				
				if(bachelor_rent_max==MAX_ROOM_RENT)
				{
					$('#bachelor_rent_max').html(bachelor_rent_max+'+');
				}else{
					$('#bachelor_rent_max').html(bachelor_rent_max);
				}
			});
			$('#bachelor_rent_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#bedroom1_rent_min').html(MIN_ROOM_RENT);
			$('#bedroom1_rent_max').html(MAX_ROOM_RENT+'+');
			$('#bedroom1_rent_slider').on('slide',function(slideEvt){
				bedroom1_rent_min = slideEvt.value[0];
				bedroom1_rent_max = slideEvt.value[1];
				$('#bedroom1_rent_min').html(bedroom1_rent_min);
				
				if(bedroom1_rent_max==MAX_ROOM_RENT)
				{
					$('#bedroom1_rent_max').html(bedroom1_rent_max+'+');
				}else{
					$('#bedroom1_rent_max').html(bedroom1_rent_max);
				}
			});
			$('#bedroom1_rent_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#bedroom2_rent_min').html(MIN_ROOM_RENT);
			$('#bedroom2_rent_max').html(MAX_ROOM_RENT+'+');
			$('#bedroom2_rent_slider').on('slide',function(slideEvt){
				bedroom2_rent_min = slideEvt.value[0];
				bedroom2_rent_max = slideEvt.value[1];
				$('#bedroom2_rent_min').html(bedroom2_rent_min);
				
				if(bedroom2_rent_max==MAX_ROOM_RENT)
				{
					$('#bedroom2_rent_max').html(bedroom2_rent_max+'+');
				}else{
					$('#bedroom2_rent_max').html(bedroom2_rent_max);
				}
			});
			$('#bedroom2_rent_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#bedroom3_rent_min').html(MIN_ROOM_RENT);
			$('#bedroom3_rent_max').html(MAX_ROOM_RENT+'+');
			$('#bedroom3_rent_slider').on('slide',function(slideEvt){
				bedroom3_rent_min = slideEvt.value[0];
				bedroom3_rent_max = slideEvt.value[1];
				$('#bedroom3_rent_min').html(bedroom3_rent_min);
				
				if(bedroom3_rent_max==MAX_ROOM_RENT)
				{
					$('#bedroom3_rent_max').html(bedroom3_rent_max+'+');
				}else{
					$('#bedroom3_rent_max').html(bedroom3_rent_max);
				}
			});
			$('#bedroom3_rent_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			// Units
			$('#bachelor_units_min').html(MIN_ROOM_RENT);
			$('#bachelor_units_max').html(MAX_ROOM_UNITS+'+');
			$('#bachelor_units_slider').on('slide',function(slideEvt){
				bachelor_units_min = slideEvt.value[0];
				bachelor_units_max = slideEvt.value[1];
				$('#bachelor_units_min').html(bachelor_units_min);
				
				if(bachelor_units_max==MAX_ROOM_UNITS)
				{
					$('#bachelor_units_max').html(bachelor_units_max+'+');
				}else{
					$('#bachelor_units_max').html(bachelor_units_max);
				}
			});
			$('#bachelor_units_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#bedroom1_units_min').html(MIN_ROOM_UNITS);
			$('#bedroom1_units_max').html(MAX_ROOM_UNITS+'+');
			$('#bedroom1_units_slider').on('slide',function(slideEvt){
				bedroom1_units_min = slideEvt.value[0];
				bedroom1_units_max = slideEvt.value[1];
				$('#bedroom1_units_min').html(bedroom1_units_min);
				
				if(bedroom1_units_max==MAX_ROOM_UNITS)
				{
					$('#bedroom1_units_max').html(bedroom1_units_max+'+');
				}else{
					$('#bedroom1_units_max').html(bedroom1_units_max);
				}
			});
			$('#bedroom1_units_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#bedroom2_units_min').html(MIN_ROOM_UNITS);
			$('#bedroom2_units_max').html(MAX_ROOM_UNITS+'+');
			$('#bedroom2_units_slider').on('slide',function(slideEvt){
				bedroom2_units_min = slideEvt.value[0];
				bedroom2_units_max = slideEvt.value[1];
				$('#bedroom2_units_min').html(bedroom2_units_min);
				
				if(bedroom2_units_max==MAX_ROOM_UNITS)
				{
					$('#bedroom2_units_max').html(bedroom2_units_max+'+');
				}else{
					$('#bedroom2_units_max').html(bedroom2_units_max);
				}
			});
			$('#bedroom2_units_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#bedroom3_units_min').html(MIN_ROOM_UNITS);
			$('#bedroom3_units_max').html(MAX_ROOM_UNITS+'+');
			$('#bedroom3_units_slider').on('slide',function(slideEvt){
				bedroom3_units_min = slideEvt.value[0];
				bedroom3_units_max = slideEvt.value[1];
				$('#bedroom3_units_min').html(bedroom3_units_min);
				
				if(bedroom3_units_max==MAX_ROOM_UNITS)
				{
					$('#bedroom3_units_max').html(bedroom3_units_max+'+');
				}else{
					$('#bedroom3_units_max').html(bedroom3_units_max);
				}
			});
			
			$('#bedroom3_units_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			$('#building_income_slider').attr('data-slider-min',MIN_BUILDING_INCOME); // corrects limit
			$('#building_income_slider').attr('data-slider-max',MAX_BUILDING_INCOME); // corrects limit
			$('#building_income_slider').attr('data-slider-step',STEP_BUILDING_INCOME); // corrects limit
			$('#building_income_min').html(MIN_BUILDING_INCOME);
			$('#building_income_max').html(MAX_BUILDING_INCOME+'+');
			$('#building_income_slider').attr('data-slider-value','['+MIN_BUILDING_INCOME+','+MAX_BUILDING_INCOME+']');
			$('#building_income_slider').slider({tooltip: 'disabled'});
			$('#building_income_slider').on('slide',function(slideEvt){
				building_income_min = slideEvt.value[0];
				building_income_max = slideEvt.value[1];
				$('#building_income_min').html(building_income_min);
				
				if(building_income_max==MAX_BUILDING_INCOME)
				{
					$('#building_income_max').html(building_income_max+'+');
				}else{
					$('#building_income_max').html(building_income_max);
				}
			});
			$('#building_income_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			$('#elevator_installed_year_slider').attr('data-slider-min',MIN_ELEVATOR_INSTALLED_YEAR); // corrects limit
			$('#elevator_installed_year_slider').attr('data-slider-max',MAX_ELEVATOR_INSTALLED_YEAR); // corrects limit
			$('#elevator_installed_year_slider').attr('data-slider-step',STEP_ELEVATOR_INSTALLED_YEAR); // corrects limit
			$('#elevator_installed_year_min').html(MIN_ELEVATOR_INSTALLED_YEAR);
			$('#elevator_installed_year_max').html(MAX_ELEVATOR_INSTALLED_YEAR+'+');
			$('#elevator_installed_year_slider').attr('data-slider-value','['+MIN_ELEVATOR_INSTALLED_YEAR+','+MAX_ELEVATOR_INSTALLED_YEAR+']');
			$('#elevator_installed_year_slider').slider({tooltip: 'disabled'});
			$('#elevator_installed_year_slider').on('slide',function(slideEvt){
				elevator_installed_year_min = slideEvt.value[0];
				elevator_installed_year_max = slideEvt.value[1];
				$('#elevator_installed_year_min').html(elevator_installed_year_min);
				
				if(elevator_installed_year_max==MAX_ELEVATOR_INSTALLED_YEAR)
				{
					$('#elevator_installed_year_max').html(elevator_installed_year_max+'+');
				}else{
					$('#elevator_installed_year_max').html(elevator_installed_year_max);
				}
			});
			$('#elevator_installed_year_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#unit_price_slider').attr('data-slider-min',MIN_UNIT_PRICE); // corrects limit
			$('#unit_price_slider').attr('data-slider-max',MAX_UNIT_PRICE); // corrects limit
			$('#unit_price_slider').attr('data-slider-step',STEP_UNIT_PRICE); // corrects limit
			$('#unit_price_min').html(MIN_UNIT_PRICE==0?0:(MIN_UNIT_PRICE+'-'));
			$('#unit_price_max').html(MAX_UNIT_PRICE+'+');
			$('#unit_price_slider').attr('data-slider-value','['+MIN_UNIT_PRICE+','+MAX_UNIT_PRICE+']');
			$('#unit_price_slider').slider({tooltip: 'disabled'});
			$('#unit_price_slider').on('slide',function(slideEvt){
				unit_price_min = slideEvt.value[0];
				unit_price_max = slideEvt.value[1];
				if(unit_price_min==MIN_UNIT_PRICE)
				{
					if(MIN_UNIT_PRICE!=0){
						$('#unit_price_min').html(unit_price_min+'-');
					}else{
						$('#unit_price_min').html(unit_price_min);
					}
				}else{
					$('#unit_price_min').html(unit_price_min);
				}
				
				if(unit_price_max==MAX_UNIT_PRICE)
				{
					$('#unit_price_max').html(unit_price_max+'+');
				}else{
					$('#unit_price_max').html(unit_price_max);
				}
			});
			$('#unit_price_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			$('#elevator_upgrade_year_slider').attr('data-slider-min',MIN_ELEVATOR_UPGRADE_YEAR); // corrects limit
			$('#elevator_upgrade_year_slider').attr('data-slider-max',MAX_ELEVATOR_UPGRADE_YEAR); // corrects limit
			$('#elevator_upgrade_year_slider').attr('data-slider-step',STEP_ELEVATOR_UPGRADE_YEAR); // corrects limit
			$('#elevator_upgrade_year_min').html(MIN_ELEVATOR_UPGRADE_YEAR);
			$('#elevator_upgrade_year_max').html(MAX_ELEVATOR_UPGRADE_YEAR+'+');
			$('#elevator_upgrade_year_slider').attr('data-slider-value','['+MIN_ELEVATOR_UPGRADE_YEAR+','+MAX_ELEVATOR_UPGRADE_YEAR+']');
			$('#elevator_upgrade_year_slider').slider({tooltip: 'disabled'});
			$('#elevator_upgrade_year_slider').on('slide',function(slideEvt){
				elevator_upgrade_year_min = slideEvt.value[0];
				elevator_upgrade_year_max = slideEvt.value[1];
				$('#elevator_upgrade_year_min').html(elevator_upgrade_year_min);
				
				if(elevator_upgrade_year_max==MAX_ELEVATOR_UPGRADE_YEAR)
				{
					$('#elevator_upgrade_year_max').html(elevator_upgrade_year_max+'+');
				}else{
					$('#elevator_upgrade_year_max').html(elevator_upgrade_year_max);
				}
			});
			$('#elevator_upgrade_year_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			$('#cap_rate_slider').attr('data-slider-min',MIN_CAP_RATE); // corrects limit
			$('#cap_rate_slider').attr('data-slider-max',MAX_CAP_RATE); // corrects limit
			$('#cap_rate_slider').attr('data-slider-step',STEP_CAP_RATE); // corrects limit
			$('#cap_rate_min').html(MIN_CAP_RATE);
			$('#cap_rate_max').html(MAX_CAP_RATE+'+');
			$('#cap_rate_slider').attr('data-slider-value','['+MIN_CAP_RATE+','+MAX_CAP_RATE+']');
			$('#cap_rate_slider').slider({tooltip: 'disabled'});
			$('#cap_rate_slider').on('slide',function(slideEvt){
				cap_rate_min = slideEvt.value[0];
				cap_rate_max = slideEvt.value[1];
				$('#cap_rate_min').html(cap_rate_min);
				
				if(cap_rate_max==MAX_CAP_RATE)
				{
					$('#cap_rate_max').html(cap_rate_max+'+');
				}else{
					$('#cap_rate_max').html(cap_rate_max);
				}
			});
			$('#cap_rate_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			$('#sale_price_slider').attr('data-slider-min',MIN_SALE_PRICE); // corrects limit
			$('#sale_price_slider').attr('data-slider-max',MAX_SALE_PRICE); // corrects limit
			$('#sale_price_slider').attr('data-slider-step',STEP_SALE_PRICE); // corrects limit
			$('#sale_price_min').html(MIN_SALE_PRICE);
			$('#sale_price_max').html(MAX_SALE_PRICE+'+');
			$('#sale_price_slider').attr('data-slider-value','['+MIN_SALE_PRICE+','+MAX_SALE_PRICE+']');
			$('#sale_price_slider').slider({tooltip: 'disabled'});
			$('#sale_price_slider').on('slide',function(slideEvt){
				sale_price_min = slideEvt.value[0];
				sale_price_max = slideEvt.value[1];
				$('#sale_price_min').html(sale_price_min);
				
				if(sale_price_max==MAX_SALE_PRICE)
				{
					$('#sale_price_max').html(sale_price_max+'+');
				}else{
					$('#sale_price_max').html(sale_price_max);
				}
			});
			$('#sale_price_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
		
		
			$('#assessed_value_slider').attr('data-slider-min',MIN_ASSESSED_VALUE); // corrects limit
			$('#assessed_value_slider').attr('data-slider-max',MAX_ASSESSED_VALUE); // corrects limit
			$('#assessed_value_slider').attr('data-slider-step',STEP_ASSESSED_VALUE); // corrects limit
			$('#assessed_value_min').html(MIN_ASSESSED_VALUE);
			$('#assessed_value_max').html(MAX_ASSESSED_VALUE+'+');
			$('#assessed_value_slider').attr('data-slider-value','['+MIN_ASSESSED_VALUE+','+MAX_ASSESSED_VALUE+']');
			$('#assessed_value_slider').slider({tooltip: 'disabled'});
			$('#assessed_value_slider').on('slide',function(slideEvt){
				assessed_value_min = slideEvt.value[0];
				assessed_value_max = slideEvt.value[1];
				$('#assessed_value_min').html(assessed_value_min);
				
				if(assessed_value_max==MAX_ASSESSED_VALUE)
				{
					$('#assessed_value_max').html(assessed_value_max+'+');
				}else{
					$('#assessed_value_max').html(assessed_value_max);
				}
			});
			$('#assessed_value_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#boiler_installed_year_slider').attr('data-slider-min',MIN_BOILER_INSTALLED_YEAR); // corrects limit
			$('#boiler_installed_year_slider').attr('data-slider-max',MAX_BOILER_INSTALLED_YEAR); // corrects limit
			$('#boiler_installed_year_slider').attr('data-slider-step',STEP_BOILER_INSTALLED_YEAR); // corrects limit
			$('#boiler_installed_year_min').html(MIN_BOILER_INSTALLED_YEAR);
			$('#boiler_installed_year_max').html(MAX_BOILER_INSTALLED_YEAR+'+');
			$('#boiler_installed_year_slider').attr('data-slider-value','['+MIN_BOILER_INSTALLED_YEAR+','+MAX_BOILER_INSTALLED_YEAR+']');
			$('#boiler_installed_year_slider').slider({tooltip: 'disabled'});
			$('#boiler_installed_year_slider').on('slide',function(slideEvt){
				boiler_installed_year_min = slideEvt.value[0];
				boiler_installed_year_max = slideEvt.value[1];
				$('#boiler_installed_year_min').html(boiler_installed_year_min);
				
				if(boiler_installed_year_max==MAX_BOILER_INSTALLED_YEAR)
				{
					$('#boiler_installed_year_max').html(boiler_installed_year_max+'+');
				}else{
					$('#boiler_installed_year_max').html(boiler_installed_year_max);
				}
			});
			$('#boiler_installed_year_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#boiler_upgrade_slider').attr('data-slider-min',MIN_BOILER_UPGRADE); // corrects limit
			$('#boiler_upgrade_slider').attr('data-slider-max',MAX_BOILER_UPGRADE); // corrects limit
			$('#boiler_upgrade_slider').attr('data-slider-step',STEP_BOILER_UPGRADE); // corrects limit
			$('#boiler_upgrade_min').html(MIN_BOILER_UPGRADE);
			$('#boiler_upgrade_max').html(MAX_BOILER_UPGRADE+'+');
			$('#boiler_upgrade_slider').attr('data-slider-value','['+MIN_BOILER_UPGRADE+','+MAX_BOILER_UPGRADE+']');
			$('#boiler_upgrade_slider').slider({tooltip: 'disabled'});
			$('#boiler_upgrade_slider').on('slide',function(slideEvt){
				boiler_upgrade_min = slideEvt.value[0];
				boiler_upgrade_max = slideEvt.value[1];
				$('#boiler_upgrade_min').html(boiler_upgrade_min);
				
				if(boiler_upgrade_max==MAX_BOILER_UPGRADE)
				{
					$('#boiler_upgrade_max').html(boiler_upgrade_max+'+');
				}else{
					$('#boiler_upgrade_max').html(boiler_upgrade_max);
				}
			});
			$('#boiler_upgrade_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
		
			$('#heat_age_slider').attr('data-slider-min',MIN_HEAT_AGE); // corrects limit
			$('#heat_age_slider').attr('data-slider-max',MAX_HEAT_AGE); // corrects limit
			$('#heat_age_slider').attr('data-slider-step',STEP_HEAT_AGE); // corrects limit
			$('#heat_age_min').html(MIN_HEAT_AGE);
			$('#heat_age_max').html(MAX_HEAT_AGE+'+');
			$('#heat_age_slider').attr('data-slider-value','['+MIN_HEAT_AGE+','+MAX_HEAT_AGE+']');
			$('#heat_age_slider').slider({tooltip: 'disabled'});
			$('#heat_age_slider').on('slide',function(slideEvt){
				heat_age_min = slideEvt.value[0];
				heat_age_max = slideEvt.value[1];
				$('#heat_age_min').html(heat_age_min);
				
				if(heat_age_max==MAX_HEAT_AGE)
				{
					$('#heat_age_max').html(heat_age_max+'+');
				}else{
					$('#heat_age_max').html(heat_age_max);
				}
			});
			$('#heat_age_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
		
			$('#sales_count_slider').attr('data-slider-min',MIN_SALES_COUNT); // corrects limit
			$('#sales_count_slider').attr('data-slider-max',MAX_SALES_COUNT); // corrects limit
			$('#sales_count_slider').attr('data-slider-step',STEP_SALES_COUNT); // corrects limit
			$('#sales_count_min').html(MIN_SALES_COUNT);
			$('#sales_count_max').html(MAX_SALES_COUNT+'+');
			$('#sales_count_slider').attr('data-slider-value','['+MIN_SALES_COUNT+','+MAX_SALES_COUNT+']');
			$('#sales_count_slider').slider({tooltip: 'disabled'});
			$('#sales_count_slider').on('slide',function(slideEvt){
				sales_count_min = slideEvt.value[0];
				sales_count_max = slideEvt.value[1]
				$('#sales_count_min').html(sales_count_min);
				
				if(sales_count_max==MAX_SALES_COUNT)
				{
					$('#sales_count_max').html(sales_count_max+'+');
				}else{
					$('#sales_count_max').html(sales_count_max);
				}
			});
			$('#sales_count_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			$('#windows_installed_year_slider').attr('data-slider-min',MIN_WINDOWS_INSTALLED_YEAR); // corrects limit
			$('#windows_installed_year_slider').attr('data-slider-max',MAX_WINDOWS_INSTALLED_YEAR); // corrects limit
			$('#windows_installed_year_slider').attr('data-slider-step',STEP_WINDOWS_INSTALLED_YEAR); // corrects limit
			$('#windows_installed_year_min').html(MIN_WINDOWS_INSTALLED_YEAR);
			$('#windows_installed_year_max').html(MAX_WINDOWS_INSTALLED_YEAR+'+');
			$('#windows_installed_year_slider').attr('data-slider-value','['+MIN_WINDOWS_INSTALLED_YEAR+','+MAX_WINDOWS_INSTALLED_YEAR+']');
			$('#windows_installed_year_slider').slider({tooltip: 'disabled'});
			$('#windows_installed_year_slider').on('slide',function(slideEvt){
				windows_installed_year_min = slideEvt.value[0];
				windows_installed_year_max = slideEvt.value[1]
				$('#windows_installed_year_min').html(windows_installed_year_min);
				
				if(windows_installed_year_max==MAX_WINDOWS_INSTALLED_YEAR)
				{
					$('#windows_installed_year_max').html(windows_installed_year_max+'+');
				}else{
					$('#windows_installed_year_max').html(windows_installed_year_max);
				}
			});
			$('#windows_installed_year_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
			
			$('#parking_spots_slider').attr('data-slider-min',MIN_PARKING_SPOTS); // corrects limit
			$('#parking_spots_slider').attr('data-slider-max',MAX_PARKING_SPOTS); // corrects limit
			$('#parking_spots_slider').attr('data-slider-step',STEP_PARKING_SPOTS); // corrects limit
			$('#parking_spots_min').html(MIN_PARKING_SPOTS);
			$('#parking_spots_max').html(MAX_PARKING_SPOTS+'+');
			$('#parking_spots_slider').attr('data-slider-value','['+MIN_PARKING_SPOTS+','+MAX_PARKING_SPOTS+']');
			$('#parking_spots_slider').slider({tooltip: 'disabled'});
			$('#parking_spots_slider').on('slide',function(slideEvt){
				parking_spots_min = slideEvt.value[0];
				parking_spots_max = slideEvt.value[1]
				$('#parking_spots_min').html(parking_spots_min);
				
				if(parking_spots_max==MAX_PARKING_SPOTS)
				{
					$('#parking_spots_max').html(parking_spots_max+'+');
				}else{
					$('#parking_spots_max').html(parking_spots_max);
				}
			});
			$('#parking_spots_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
			
		
			$('#units_slider').attr('data-slider-max',sliderLimit); // corrects limit
			$('#units_slider').slider({tooltip: 'disabled'});
			$('#units_slider').on('slide',function(slideEvt){
				unitsMin = slideEvt.value[0];
				unitsMax = slideEvt.value[1]
				$('#units_min').html(unitsMin);
				
				if(unitsMax==sliderLimit)
				{
					$('#units_max').html(unitsMax+'+');
				}else{
					$('#units_max').html(unitsMax);
				}
			});
			$('#units_slider').on('slideStop',function(slideEvt){
				setTimeout(function(){
					datatable.api().ajax.reload();
				},10);
			});
		}
		initSliders();
		
		
		
		
		
		
		
		
		
        $(window).resize(function(){
        	if(typeof(markers)!='undefined'&&$('#building_slideup_wrapper').html()!=''){
				markers.blockIdleEvent = true;
				google.maps.event.trigger(map, "resize");
			}
        	setMapSize();
			setMapTableSize();
			
			snapClose();
			
        });
        
        $(window).scroll(function(){
        	if($(window).scrollTop()>($('#map_wrapper').height()+$('#building_slideup_wrapper').height())/2){
        		$('#search_toggler').attr('scrollstate','bottom');
			}else{
				$('#search_toggler').attr('scrollstate','top');
			}
        });
        
        $('.main-content').scroll(function(){
        	if($('.main-content').scrollTop()>($('#map_wrapper').height()+$('#building_slideup_wrapper').height())/2){
        		$('#search_toggler').attr('scrollstate','bottom');
			}else{
				$('#search_toggler').attr('scrollstate','top');
			}
    	});
        
        function snapFar(){
        	if($('body').width()>979){
    			if($('.main-content').scrollTop()>($('#map_wrapper').height()+$('#building_slideup_wrapper').height())/2){
    				//$('.main-content').scrollTop(0)
    				$('.main-content').animate({scrollTop:0}, 'fast');
    			}else{
    				//$('.main-content').scrollTop($('#map_wrapper').height()+$('#building_slideup_wrapper').height());
    				$('.main-content').animate({scrollTop:$('#map_wrapper').height()+$('#building_slideup_wrapper').height()}, 'fast');
    			}
    		}else{
    			if($(window).scrollTop()>($('#map_wrapper').height()+$('#building_slideup_wrapper').height())/2){
    				//$('body').scrollTop(0);
    				$('body,html').animate({scrollTop:0}, 'fast');
    			}else{
    				//$('body').scrollTop($('#map_wrapper').height()+$('#building_slideup_wrapper').height()+$('.navbar-fixed-top').height());
    				$('body,html').animate({scrollTop:$('#map_wrapper').height()+$('#building_slideup_wrapper').height()+$('.navbar-fixed-top').height()},'fast');
    			}
    		}
        }
        
        function snapClose(){
        	return;
        	if($('body').width()>979){
    			if($('.main-content').scrollTop()<($('#map_wrapper').height()+$('#building_slideup_wrapper').height())/2){
    				$('#search_toggler').attr('scrollstate','top');
					$('.main-content').animate({scrollTop:0}, 'fast');
    				//$('.main-content').scrollTop(0);
    			}else{
    				$('#search_toggler').attr('scrollstate','bottom');
    				$('.main-content').animate({scrollTop:$('#map_wrapper').height()+$('#building_slideup_wrapper').height()}, 'fast');
    				//$('.main-content').scrollTop($('#map_wrapper').height()+$('#building_slideup_wrapper').height());
    			}
    		}else{
    			if($('body').scrollTop()<($('#map_wrapper').height()+$('#building_slideup_wrapper').height())/2){
    				$('#search_toggler').attr('scrollstate','top');
    				//$('body').scrollTop(0);
    				$('body').animate({scrollTop:0}, 'fast');
    			}else{
    				$('#search_toggler').attr('scrollstate','bottom');
    				//$('body').scrollTop($('#map_wrapper').height()+$('#building_slideup_wrapper').height()+$('.navbar-fixed-top').height());    				
    				$('body').animate({scrollTop:$('#map_wrapper').height()+$('#building_slideup_wrapper').height()+$('.navbar-fixed-top').height()}, 'fast');
    			}
    		}        
        }
        
        function setMapTableSize(){
			var h = $('body').height()-$('#search_controls').height()-$('#table_controls').height()+$('#buildings_wrapper div.dataTables_scrollBody').height();
			if($('body').width()>979){
				h = h - $('.navbar-fixed-top').height();
			}
			if($('#buildings_wrapper div.dataTables_scrollBody').height()<1){
				setTimeout(function(){
					setMapTableSize();
				},100);
			}
			$('#buildings_wrapper div.dataTables_scrollBody').height(h>=minimumTableSize?h+1:minimumTableSize+'px');
        }
        
        function setMapSize(){
        	//if(typeof(markers)!='undefined'){
			//	markers.blockIdleEvent = true;
			//	google.maps.event.trigger(map, "resize");
			//	markers.blockIdleEvent = false;
			//}
			var mapheightval = $('body').height()-$('#building_slideup_wrapper').height()-$('.navbar-fixed-top').height()-50;
			$('#map_wrapper').height(mapheightval);

			
			
        }
	    
	    
        $("#start_time_gen" ).datetimepicker({
            language: 'en',
            format: 'yyyy-MM-dd hh:mm',
            pick12HourFormat: false,
            pickSeconds: false
        }).data('datetimepicker');
		$("#start_time_gen" ).data('datetimepicker').$element.on('changeDate',function(e,y){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('.bootstrap-datetimepicker-widget:not([picker_name])').attr('picker_name','start_time_gen');

        $("#end_time_gen" ).datetimepicker({
            language: 'en',
            format: 'yyyy-MM-dd hh:mm',
            pick12HourFormat: false,
            pickSeconds: false
        }).data('datetimepicker');
		$("#end_time_gen" ).data('datetimepicker').$element.on('changeDate',function(e,y){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('.bootstrap-datetimepicker-widget:not([picker_name])').attr('picker_name','end_time_gen');
		
		$("#start_mortgage_due_date_gen" ).datetimepicker({
            language: 'en',
            format: 'yyyy-MM-dd hh:mm',
            pick12HourFormat: false,
            pickSeconds: false
        }).data('datetimepicker');
		$("#start_mortgage_due_date_gen" ).data('datetimepicker').$element.on('changeDate',function(e,y){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('.bootstrap-datetimepicker-widget:not([picker_name])').attr('picker_name','start_time_gen');
		
        $("#end_mortgage_due_date_gen" ).datetimepicker({
            language: 'en',
            format: 'yyyy-MM-dd hh:mm',
            pick12HourFormat: false,
            pickSeconds: false
        }).data('datetimepicker');
        $("#end_mortgage_due_date_gen" ).data('datetimepicker').setDate(null);
		$("#end_mortgage_due_date_gen" ).data('datetimepicker').$element.on('changeDate',function(e,y){
			setTimeout(function(){
				datatable.api().ajax.reload();
			},10);
		});
		$('.bootstrap-datetimepicker-widget:not([picker_name])').attr('picker_name','end_mortgage_due_date_gen');
		
        $('#advanced_criteria_toggler').click(function(){
        	if($('#collapseadvanced').height()<=0){
        		$('#advanced_criteria_toggler > div > i').removeClass('icon-plus-sign').removeClass('icon-minus-sign').addClass('icon-minus-sign');
        	}else{
        		$('#advanced_criteria_toggler > div > i').removeClass('icon-minus-sign').removeClass('icon-plus-sign').addClass('icon-plus-sign');
        	}
    	});
        
        
        
        function rebindDateTimePickerCloser(){
	        $('.bootstrap-datetimepicker-widget > div > div.close-datetime').unbind();
	        $('.bootstrap-datetimepicker-widget > div > div.close-datetime').click(function(){
	            $("#end_time_gen" ).data('datetimepicker').hide();
	            $("#start_time_gen" ).data('datetimepicker').hide();
	        });
        }
        rebindDateTimePickerCloser();
        
    	
    	
        
    });
</script>
